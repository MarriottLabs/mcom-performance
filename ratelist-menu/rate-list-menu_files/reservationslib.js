
window.MI.res=MI.res||{};window.MI.res.roomRate=(function(){var signInRequiredRates;var redemptionRates;var meoRates;var eeoRates;var signInType;magnificPopupInstance=$.magnificPopup.instance;var $form=$('#roomRatesSelectionForm');var $roomRateContainer=$('#room-rate-container');var $methodNameHidden=$(':hidden[name=methodName]');var $tempRateSelected=$('#temp-rate-selected');var $previousRateSelected=$("#previous-rate-selected");var $selectedRphIndex=$('#selectedRphIndex');var currentRph;var $cashPointCheckbox=$('.use-points-trigger');if($selectedRphIndex){currentRph=$('#selectedRphIndex').val();}
var $rmPolView=$('#js-room-pool-view');if($rmPolView){$rmPolViewVal=$rmPolView.val();}
var _continueHandler=function(rph){return function(e){e.preventDefault();$('#selectedRphIndex').val(rph);if(!_signInPanelEvent(rph)){$form.submit();}};};var _setSignInArrays=function(){var signInArrayCleanUp=function($arrayToClean){var cleanUp=/[^0-9,]/gi;var cleanArray='';if($arrayToClean.length){cleanArray=$arrayToClean.val().replace(cleanUp,'').split(',');}
return cleanArray;};signInRequiredRates=signInArrayCleanUp($('#signin-required-rates'));redemptionRates=signInArrayCleanUp($('#required-rates-redemption'));meoRates=signInArrayCleanUp($('#required-rates-meo'));eeoRates=signInArrayCleanUp($('#required-rates-eeo'));flashPerkRates=signInArrayCleanUp($('#required-rates-flp'));};var _signInPanelEvent=function(rph){var doNeedSignIn=false;if($('#sign-in-panel').length>0&&signInRequiredRates!=''){if($.inArray(rph.toString(),signInRequiredRates)!=-1){var selectRateValue=rph.toString();var enrollLink=$('#enroll-link');if($(enrollLink).length){$(enrollLink).replaceWith('<span id="enroll-submit">'+$(enrollLink).html()+'</span>');}
var createPasswordLink=$('#create-password-link');if($(createPasswordLink).length){var passwdlink=$(createPasswordLink).html();$(createPasswordLink).replaceWith('<span id="create-password-submit" title="'+passwdlink+'">'+passwdlink+'</span>');}
if($.inArray(selectRateValue,meoRates)!=-1){signInType='MEO';_hideSignInMsg();rateMessage=$(':hidden[name="meoRateMessage"]').val();}else if($.inArray(selectRateValue,eeoRates)!=-1){var $joinRewardsSection=$('#join-rewards-section');signInType='EEO';rateMessage=$(':hidden[name="eeoRateMessage"]').val();if($joinRewardsSection.length){$joinRewardsSection.hide();}
_hideSignInMsg();}else if($.inArray(selectRateValue,flashPerkRates)!=-1){signInType='FLP';}else if($.inArray(selectRateValue,redemptionRates)!=-1){signInType='redemption';rateMessage=$(':hidden[name="redemptionRateMessage"]').val();}
if($('#display-intro-message').length>0){$('#display-intro-message').remove();}
if($('#sign-in-section').length){$('#sign-in-section:first').prepend('<div id="display-intro-message">'+rateMessage+'</div>');}
if($('#sign-in-remembered-section').length){$('#sign-in-remembered-section:first').prepend('<div id="display-intro-message">'+rateMessage+'</div>');}}
else{signInType='';}
if(signInType!=''){_signInPanelDialog();doNeedSignIn=true;}}
return doNeedSignIn;};var _hideSignInMsg=function(){if(signInType.length>0){$('.js-make-faster').hide();$('.js-guest-btn').hide();}else{$('.js-use-pts').hide();};};var _signInPanelDialog=function(){var $rememberMeHidden=$('input:hidden[name=rememberMe]');$('#close-link').css('text-decoration','none').show();$rememberMeHidden.val($('#remember-me').prop('checked'));var closeText=msgResources.closeText||'Close';var loadingText=msgResources.loadingText||'Loading...';var teaser=$(".teaser").clone();teaser.find("img").remove()
$.magnificPopup.open({mainClass:'m-modal t-modal-med l-signin-modal',items:{src:'#sign-in-panel',type:'inline'},closeMarkup:'<div class="m-modal-utilities t-blck">'
+'<button class="m-modal-close mfp-close is-hover-fix">%title% <i class="icon mfp-close icon-close"></i></button>'
+'</div>',tClose:closeText,tLoading:loadingText,callbacks:{beforeOpen:function(){this.container.attr('aria-live','assertive');$('#page-container').attr('aria-hidden','true');},open:function(){var $form=$('#roomRatesSelectionForm');var $modalContent=$('#sign-in-panel');$('.js-guest-btn').on('click',function(e){e.preventDefault();$.magnificPopup.close();});if($rememberMeHidden.val()=='true'){$('#remember-me').prop('checked','true');}
$modalContent.find('input, .m-button-default').keyup(function(e){if(e.keyCode==13){submitRateSelectionForm();}});$modalContent.find('.m-button-default').on('click',function(){submitRateSelectionForm();});function submitRateSelectionForm(){if($('#remember-me').is(':checked')){$('input:hidden[name=rememberMe]').val('true');}
else{$('input:hidden[name=rememberMe]').val('false');}
$('input:hidden[name=methodName]').val('saveRateandSignIn');$('input:hidden[name=userID]').val($('#user-id').val());$('input:hidden[name=password]').val($('#password').val());$form.submit();}
setTimeout(function(){$modalContent.show().attr('aria-hidden','false');},100);},close:function(){$('#page-container').removeAttr('aria-hidden');$('#sign-in-panel').attr('aria-hidden','true');}}});};var _cashAndPointsControlHandler=function(rph){return function(){_addCashAndPoints(rph);};};var _addCashAndPoints=function(rph){var $selectedCashPointsCheckBox=$('#cash-and-points-trigger-'+rph);if($selectedCashPointsCheckBox.prop('checked')){$selectedCashPointsCheckBox.parents('.m-room-type-panel').addClass('m-cnp-open')
$('.room-rules').show();var cprow=$('#cash-and-points-row-'+rph);var cashPointsBlock=$roomRateContainer.data('masterCashPoints');cprow.append(cashPointsBlock);cashAndPoints.initialize(rph);}
else{_closeAllCashAndPointPanel();}
currentRph=rph;};var _closeCashAndPointOnBreakPointChange=function(){var thisWidth=$(window).width();$(window).on('resize',function(){if(thisWidth!=$(window).width()){$('.use-points-trigger:checked').trigger('click');thisWidth=$(window).width();}});};var _closeAllCashAndPointPanel=function(){$cashPointCheckbox.each(function(){if($(this).prop('checked',false)){$(this).parents('.m-room-type-panel').removeClass('m-cnp-open')
$('#cash-points-container').hide();}})};var _initPanels=function(obj){$roomRateContainer.addClass('default');var masterCashPointsPanel=$('#master-cash-points-panel #cash-points-container');$roomRateContainer.data('masterCashPoints',masterCashPointsPanel);};var _displayCashPointMsg=function(){var $cpMessaging=$('.cash-points-messaging');if($cpMessaging.length>0){$('.close-cash-points-messaging',$cpMessaging).click(function(e){$cpMessaging.slideUp(500,function(){$(this).hide()});e.preventDefault();});}
var $cpToggleLink=$('.js-cP-toggle-link');if($cpToggleLink.length>0){$('.js-cP-toggle-link').click(function(e){e.preventDefault();var $cashPointcheckbox=$(this).parents('.l-rph-rate-list').next().find('.use-points-trigger');if($cashPointcheckbox.length>0){$cashPointcheckbox.click();}});}};var _cashPointhandler=function($obj){var cnpCheckBox=$cashPointCheckbox;$.extend(cnpCheckBox,$obj);cnpCheckBox.each(function(){var rph=$(this).data('rphindex');if($(this).prop("checked")===true){_addCashAndPoints(rph);}
$(this).on('change',_cashAndPointsControlHandler(rph));})};var _roomRateTabs=function(){var disabledTab=eval("["+$('#room-rate-container :hidden[name=disabledTab]').val()+"]");var selectedTab=0;if(($roomRateContainer.length>0)&&($roomRateContainer.data('meoeeoratesavailable')==='true')){selectedTab=$roomRateContainer.data('tabsize'-1);}else{for(var i=0;i<4;i++){if(jQuery.inArray(i,disabledTab)==-1){selectedTab=i;break;}}}
if($roomRateContainer.data('ratetabs')==true){$roomRateContainer.tabs({selected:selectedTab,disabled:disabledTab});};var $resultsContainerHeader=$('h3.results-container-subheader');if($resultsContainerHeader.length>0){$resultsContainerHeader.remove();}
$('ul#anchors').addClass('rate-type-tabs clearFloat');$('ul.rate-type-tabs').removeAttr("id");$('.room-rate-results tr:first-child td').css("border-top","none");};var _initialState=function(){$('[name="continue"]').removeClass('is-hidden').show();$('.l-per-room-prefs h4 span').removeClass('is-hidden');$('.l-per-room-prefs h4').removeClass('is-hidden');$('#hidden-rewards-trigger span').removeClass('is-hidden');$('#hidden-special-rates-trigger span').removeClass('is-hidden');$('.backToTop').hide();$roomRateContainer.find('tr.nonjs-row').removeClass('nonjs-row');$('#room-rate-container, #room-rate-container form, div.backToTop').css('left','0');$('#loading-cover').remove();};var _selectedRoomTypeOpen=function(selectedRoom){if(selectedRoom.length>0){var $selectRoomPool=$(':input[name=roomPoolCode][value='+selectedRoom+']');if($selectRoomPool.length>0){$selectRoomPool.parents('.results-container').each(function(){var selectedRoomTypeAvailable=$('#selected-room-type-available').val();if(selectedRoomTypeAvailable&&selectedRoomTypeAvailable.match('true')){var tabIndex=$(this).attr('id').charAt(3);$roomRateContainer.tabs('select',tabIndex);}
if($(this).is(':visible')){var rph=$(this).find('.rph-row').data('rphindex');$tempRateSelected.val(rph);}});}}};var _needPassword=function(){$('.js-enroll-meo, .js-activate-acc').on('click',function(e){e.preventDefault();$(':hidden[name=selectedRphIndex]').val($selectedRphIndex.val());if($(this).is('.js-enroll-meo'))$methodNameHidden.val('saveRateandEnroll');if($(this).is('.js-activate-acc'))$methodNameHidden.val('saveRateandActivateAccount');$form.submit();});};var _selectedRoomOpen=function(rph){if($rmPolViewVal==false){var selectedRow=$('.rph-row[data-rphindex="'+rph+'"]');if(selectedRow.length>0){var tabIndex=selectedRow.parents('.results-container').attr('id').charAt(3);$roomRateContainer.tabs('select',tabIndex);if($previousRateSelected.val()){$tempRateSelected.val(previousRateSelected.val());}
if($previousRateSelected.val()!=rph){$previousRateSelected.val(rph);}}}};var _moreRateToggle=function(){$(".js-more-rates").on('click',function(e){e.preventDefault();var selected=$(this).parents('.l-more-rate').find('.js-more-rate-cont');var drawer=$(this).parent().find('.t-drawer');if(selected.is(':visible')){_showHide(false,selected,drawer);}else{_showHide(true,selected,drawer);}});};var _showHide=function(show,$selected,$drawer){if(show){$selected.attr('aria-expanded','true');$drawer.parent().attr('aria-expanded','true');$drawer.removeClass("icon-drawer-open").addClass("icon-drawer-close");$selected.show();}else{$selected.attr('aria-expanded','false');$drawer.parent().attr('aria-expanded','false');$drawer.removeClass("icon-drawer-close").addClass("icon-drawer-open");$selected.hide();}}
var _toggleEdit=function(){var $lRateListMenu=$('.l-rate-list-menu');$("#js-edit-search").unbind('click').on('click',function(e){e.preventDefault();if($lRateListMenu.hasClass('is-show-aside')){$lRateListMenu.removeClass('is-show-aside');}
else{$lRateListMenu.addClass('is-show-aside');}});$(".js-close").on('click',function(){$lRateListMenu.removeClass('is-show-aside');});};var _selectedRoomState=function(){var selectedRoom=$('#selected-room').val();var selectedRoomType=$('#selected-room-type').val();var selectedRow=$('.rph-row:first').data('rphindex');if(selectedRoom>0){selectedRow=selectedRoom;}
$roomRateContainer.prepend('<input type="hidden" id="temp-rate-selected" value="'+selectedRow+'" />');if(selectedRoomType){_selectedRoomTypeOpen(selectedRoomType);}
else{_selectedRoomOpen(selectedRow);}};var _tiggerRoomDetailLink=function(){$('.js-room-detail-link').on('click',function(e){e.preventDefault();$(this).parents('.m-room-type-panel').find('.m-room-details-link')[0].click();});}
var _rmRateAjax=function ajaxPost(url,form){return $.ajax({url:url,type:"POST",data:form.serialize(),beforeSend:function(){$('<div class="is-loading-ajax"></div>').appendTo('body');},error:function(XMLHttpRequest,textStatus,errorThrown){alert('Error making AJAX call: '+XMLHttpRequest.statusText+' ('+XMLHttpRequest.status+')');},success:function(data,textStatus){return data;}})};var _roomRateFilterToogle=function(){var redem=$('.js-redemption-filter'),cash=$('.js-cash-filters'),useReward=$('#use-rewards-points'),boxes=$('.js-filter-control');$('.js-roomRate-rdbtns').on('change',function(evt){if(evt.target.checked&&evt.target.value==='0'){boxes.attr('checked',false);useReward.attr('checked',true);}else{useReward.attr('checked',false);}});$('.js-roomRate-filters').on('change',function(evt){if(evt.target.checked){cash.attr('checked',true);useReward.attr('checked',false);}});}
var _getFilterType=function(evt){var checkedVal=[];if(evt.target.type==='radio'){if(evt.target.value==='999'){$('.js-filter-control').each(function(){checkedVal.push($(this).val());});}else{checkedVal.push(evt.target.value);}}else{$('.js-filter-control').each(function(){if($(this).prop('checked')){checkedVal.push($(this).val());}});}
return checkedVal;};var _mkAjaxByFilterValue=function(filters){var $form=$("form#roomRatesSelectionForm");var $this_url='/reservation/roomRatesFilterAjax.mi?filters='+filters;var container="m-room-rate-results"
_rmRateAjax($this_url,$form).success(function(data){_appendAjaxContent(container,data);_init();_reLoadScripts();});};var _appendAjaxContent=function(container,data){var $container=$("."+container)
var content=$(data).find("."+container);$container.html(content);var $cashPointCheckbox=$container.find('.use-points-trigger');var masterCashPointpanel=$(data).find('#master-cash-points-panel');$('#master-cash-points-panel').html(masterCashPointpanel);_cashPointhandler($cashPointCheckbox);_initPanels(masterCashPointpanel)
$('.is-loading-ajax').remove();};var _callAjaxForFilter=function(){$(".js-roomRate-filterContainer").one('change',function(evt){var filters=_getFilterType(evt);if(filters.length<1){$('.js-filter-control').each(function(){filters.push($(this).val());});}
_mkAjaxByFilterValue(filters);});};var _reLoadScripts=function(){$.getScript("/common/js/mi.core.js");};var _deleteNoScriptTags=function(){$('#content-wrapper').find('noscript').each(function(){$(this).remove();})};var _init=function(){_initialState();_setSignInArrays();_initPanels();_roomRateTabs();_selectedRoomState();_displayCashPointMsg();_toggleEdit();_needPassword();_callAjaxForFilter();_moreRateToggle();_roomRateFilterToogle();_tiggerRoomDetailLink();_cashPointhandler();_closeCashAndPointOnBreakPointChange();_deleteNoScriptTags();$('.rph-row').each(function(index,row){var $row=$(row);var rph=$row.data('rphindex');var $continue=$row.find('[type="submit"]');$continue.on('click.roomRate',_continueHandler(rph));});};return{init:_init};})();$(function(){window.MI.res.roomRate.init();});$(document).ready(function(){$('.js-responsive-drawer').each(function(){$(this).drawer({breakpoints:[$(this).data('drawer-breakpoint')]});});if(jQuery.browser.msie){var emailObj=document.getElementById("email");if(emailObj){emailObj.ondrag=function(){return false;};emailObj.onselectstart=function(){return false;};}}
$('input.column-bg-color').each(function(){if($(this).attr('value')!=''){$(this).parent().css("background-color",$(this).attr('value'));}});$('#js-collapse-brand-bar').click(function(e){e.preventDefault();if($(this).hasClass('icon-drawer-close')){$(this).removeClass('icon-drawer-close');$(this).addClass('icon-drawer-open');}
else{$(this).addClass('icon-drawer-close');$(this).removeClass('icon-drawer-open');}
$(this).parent().nextAll("address, ul.m-hotel-links").slideToggle();});$(".js-previous-page").click(function(e){fnGotoPreviousPage.click(e);});if(typeof Response!='undefined'&&$('body').data('responsive')===true){var isLinkToggle=false;Response.ready(function(){Response.create({prop:"width",prefix:"r",breakpoints:[240,320,480,560,672,768,864,960],lazy:false});setEqualHeight();miSetEqualHeight({dataObjectName:'properties',$o:$(".is-same-height")});Response.crossover(function(e){e.stopPropagation();setEqualHeight();},"width");function setEqualHeight(){if(Response.band(240,768)){$('.is-same-height[data-sameheight="group-1"]').css('min-height','');}
if(Response.band(768)){$('.is-same-height[data-sameheight="group-1"]').css('min-height','');miSetEqualHeight({dataObjectName:'sameheight',$o:$(".is-same-height"),heightType:'outerHeight'});}}
Response.resize(function(){$('.is-same-height[data-properties="equalheight"]').css('min-height','');miSetEqualHeight({dataObjectName:'properties',$o:$(".is-same-height")});});});}
$(".popover").click(function(){var windowURL=window.location.href;var pageURL=$(this).attr('href').replace(/ /g,'%20')+" #page-container";var wdt='';var hgt='';if(windowURL.match('ritz')||windowURL.match('execustay')||windowURL.match('mvci')||windowURL.match('bulgari')){pageURL=$(this).attr('href').replace(/ /g,'%20');if(pageURL.match(/RateRules/)){wdt=740;hgt=548;}else if(pageURL.match(/redeemRewardsPoints/)){wdt=920;hgt=500;}else{wdt=760;hgt=400;}
WinOpen(pageURL,'','100','100',wdt,hgt);return false;}
$('body').append("<div id='wrapper_div'></div>");if(pageURL.match(/RateRules/)){wdt=605;hgt=548;}else if(pageURL.match(/redeemRewardsPoints/)){wdt=605;hgt=575;}else{wdt=760;hgt=425;}
$("#wrapper_div",parent.document.body).dialog({resizable:false,modal:true,width:wdt,height:hgt,bgiframe:true,open:function(){$('.ui-dialog-titlebar').hide();$('body').find('#wrapper_div').addClass("room-details-panel").prepend("<div id='load-img'></div>");$(this).load(pageURL,{},function(){$('#load-img').remove();$("#modal-utils").show();if($('#modal-utils').length<=0)
{$('.ui-dialog-titlebar').show();$('.ui-dialog-titlebar-close').css('display','block');}
if($("#printer-friendly").val()!="true"){var url=pageURL.replace(" #page-container","")+"&printerFriendly=true";$("#modal-util-print").bind('click',function(){window.open(url,'PrintWindow','height=400,width=730,location=yes,left=300,top=300,scrollbars=yes,menubars=no,toolbars=no,resizable=no');return false;});}
$('ul.rateRules-ul li.rateRules-AI:first').css('margin','2px 0px 7px 0px');if($('#layout-message-bar').length>0)
{$('#wrapper_div').find('#page-container').css({'height':'376px','width':'740px'});$('#wrapper_div').find('#layout-body-container').css('width','720px');$('#wrapper_div').find('#header').css({'width':'720px'});$('#wrapper_div').find('#layout-body').css({'width':'374px','padding':'20px 8px 5px 10px'});$('#wrapper_div #layout-body-container h1').css('width','374px');}
else
{$('#wrapper_div').find('#page-container').css({'width':'585px','height':'525px'});$('#wrapper_div').find('#layout-container').css('width','565px');$('#wrapper_div').find('#layout-body-container').css('width','565px');$('#wrapper_div').find('#header').css({'width':'565px'});$('#wrapper_div').find('#layout-body').css('width','565px');$('#wrapper_div').find('#rateRulesBase').css('width','545px');$('#wrapper_div').find('#rateRulesHeadline').css('width','545px');}
return false;});},focus:function(){$('#modal-util-close').click(function(){$("#wrapper_div",parent.document.body).dialog('destroy');$("#wrapper_div",parent.document.body).remove();});$(".update-link").click(function(){var roomPoolCode=$("#selectedRoomType option:selected").val();var url=$("#context-display").val()+"/reservation/viewRoomPool.mi?marshaCode="+$("#marsha-code").val()+"&roomPoolCode="+roomPoolCode+"&displayRoomPoolList=Y&src=ratelist";url=url.replace(/ /g,'%20')+" #page-container";$("#wrapper_div",parent.document.body).load(url,function(){$("#modal-utils").show();if($("#printer-friendly").val()!="true"){var printURL=url.replace(" #page-container","")+"&printerFriendly=true";$("#modal-util-print").bind('click',function(){window.open(printURL,'PrintWindow','height=400,width=730,location=yes,left=300,top=300,scrollbars=yes,menubars=no,toolbars=no,resizable=no');return false;});}
$('#wrapper_div').find('#page-container').css({'height':'376px','width':'740px'});$('#wrapper_div').find('#layout-body-container').css('width','720px');$('#wrapper_div').find('#header').css({'width':'720px'});$('#wrapper_div').find('#layout-body').css({'width':'374px','padding':'20px 8px 5px 10px'});$('#wrapper_div #layout-body-container h1').css('width','374px');return false;});return false;});}});return false;});$('.formWrapper').each(function(){$(this).children('form').height($(this).height()-60);});$(".contact-link").click(function(){var url=$(this).attr('href');window.open(url,'','height=700,width=980,location=yes,left=300,top=300,scrollbars=yes,menubars=no,toolbars=no,resizable=no');return false;});$("form#guestInformationModifyForm #privacy-url, #mr-terms-link").click(function(){var url=$(this).attr('href');sendto('','',url,'2');return false;});$('#selected-ecert-link, a.use-term-link').click(function(){var url=$(this).attr('href');sendto('','',url,'3');return false;});$('#map-directions, #business-attractions, #lrafaqUrl').click(function(){var url=$(this).attr('href');sendto('US','marriott',url,'3');return false;});$('#reedeem-pointsUrl, .rewards-link, #pointSavers-link').click(function(){var url=$(this).attr('href');sendto('US','no_brand',url,'5');return false;});$('#need-more-rooms').click(function(){var url=$(this).attr('href');sendto('US','no_brand',url,'7');return false;});$('#view-no-of-rooms').click(function(){var url=$(this).attr('href');sendto('','',url,'9');return false;});$('#view-room-pool').click(function(){var url=$(this).attr('href');sendto('','',url,'8');return false;});$("#maps-transportation a").click(function(e){var url=$(this).attr('rel');sendto('no_country','no_brand',url,'23');e.preventDefault();});$('#cancel-changes-link,#pref-cancel-changes').click(function(){confirmCancelReservationEvent($(this));return false;});$('#view-cash-rates').click(function(){$('#rateREW').checked=false;$('#PSForm').submit();});$('#view-redemption-rates').click(function(){if($('#PSForm [name = "clusterCode"]')){$(this).checked=false;}
$('#rateREW').checked=true;$('#clusterSell').checked=true;$('#corporateCode').val('');$('#groupCode').val('');$('#displayableIncentiveType_Number').val('');$('#PSForm').submit();});$('#GUEST-INFO-RESERVATION-DETAILS').click(function(){displayContext=$(this).data('site');if(displayContext=='/ritz'){return;}
var url=displayContext+'/reservation/editDatesConfirmation.mi';WinOpen(url,'','300','300','360','200');return false;});$('#view-charge-link').click(function(){var url=$(this).attr('href');WinOpen(url,"ViewReservationRates",'325','375','360','200');return false;});$('.res-visa-offer img').click(function(){var url=$(this).parent().attr('href');window.open(url);return false;});$('.future-availability-search').submit(function(){var rewardAccountId=$(this).find(':hidden[name=accountId]');var requestAccountId=$(this).find(':input[name=marriottRewardsNumber]');if(rewardAccountId.val()=="")
{return true;}
var choice=true;if(rewardAccountId.val()!=requestAccountId.val())
{var message=$("#rewardNumberNotMatch1").val()+rewardAccountId.val()+$("#rewardNumberNotMatch2").val();choice=confirm(message);if(choice)
{requestAccountId.val(rewardAccountId.val());}}
return choice;});rewardsPanel.init();$("#hidden-rewards-trigger a").click(function(e){fnToggle.click(e,this,'#hidden-rewards-container');});$("#hidden-special-rates-trigger a").click(function(e){fnToggle.click(e,this,'#hidden-special-rates-container');});specialRewardsPanel.init("#PSForm");specialRewardsPanel.init("#my-stay-search-form");$(".toggle-password").click({param:'#hidden-password-container'},toggleEvent);$(".toggle-join-rewards").click({param:'#hidden-join-rewards-container'},toggleEvent);var guestInfoFeedbackContainer="#guest-info-feedback-container";var travelPlannersContainer="#travel-agents-and-planners-container";$(guestInfoFeedbackContainer).hide();$(travelPlannersContainer).hide();$("#guest-info-feedback-trigger a").click(function(e){fnToggle.click(e,this,guestInfoFeedbackContainer);});$("#travel-agents-and-planners-trigger a").click(function(e){fnToggle.click(e,this,travelPlannersContainer);});$('#travel-agents-and-planners ~ #travel-agents-and-planners-container').css({'display':'block','overflow':'visible'});var $travelPlannerIcon=$("#js-travel-agents-and-planners span");var $travelPlannersHeader=$("#js-travel-agents-and-planners");var travelPlannersSection="#js-travel-planners-section";if(!$travelPlannersHeader.hasClass('open')){$travelPlannerIcon.removeClass('icon-drawer-close');$travelPlannerIcon.addClass('icon-drawer-open');$(travelPlannersSection).hide();}
$travelPlannersHeader.click(function(e){fnToggle.click(e,this,travelPlannersSection);});function toggleEvent(toggleVar){$(this).toggleClass("open");var $drawer=$(this).prev('span');if($drawer.length>0&&$drawer.hasClass('icon-drawer-close')){$drawer.removeClass('icon-drawer-close');$drawer.addClass('icon-drawer-open');}
else{$drawer.addClass('icon-drawer-close');$drawer.removeClass('icon-drawer-open');}
$(toggleVar.data.param).toggle();$(this).parents(".toggle:first").find(".toggle-container:first").slideToggle();return false;}
if($('#enhance-your-trip').length<=0&&$('#ancillary-container').length<=0){$('.lookup-list-wrapper .anchor-wrapper').width(542);}
$(this).keydown(function(e){if(e.which==27)
{$("#wrapper_div",parent.document.body).dialog('destroy');$("#wrapper_div",parent.document.body).remove();}});});$(function(){var hwsResTimeOutErrorMsg=$('#hws-timeout-error');if(hwsResTimeOutErrorMsg.length>0)
{var error=hwsResTimeOutErrorMsg.data('options');if((error.ritz!='true')&&(error.bulgari!='true'))
{hwsResTimeOutErrorMsg.remove();var hotelTitleArea=$('#hotel-title-area');var lightboxYPos='center';var lightboxXPos='center';if(error.execustay=='true'){lightboxXPos=321;lightboxYPos=100;}
imgHtml='<img src="'+$('#res-modal-box').data('options').alertimage+'"/>';buttonHtml='<button id="continueButton" class="submit ui-state">'+'<span class="ui-button-text">'+error.buttonlabel+'</span></button>';$.magnificPopup.open({items:{src:'#res-modal-box',type:'inline'},callbacks:{beforeOpen:function(){$('#res-modal-box').append(imgHtml);$(error.title).appendTo('#res-modal-box');$(error.content).appendTo('#res-modal-box');$('#res-modal-box').append(buttonHtml);},open:function(){$(".mfp-close").remove();$("#continueButton").click(function(){$("#res-modal-box").magnificPopup('close');$("#res-modal-box").remove();});}}});}}});$(function(){$("#sign-in-panel a.remember-me-tooltip-link").hover(function(){$('.remember-me-tooltip').toggleClass('show');var targetPosSignInWindow=$('#sign-in-panel').offset();var targetPos=$(this).offset();var tooltipHeight=$(".remember-me-tooltip").height();$(".remember-me-tooltip").css({"top":(targetPos.top-targetPosSignInWindow.top)-(tooltipHeight+20)+"px","left":(targetPos.left-targetPosSignInWindow.left)+"px"});});$("#sign-in-panel a.remember-me-tooltip-link").click(function(event){event.preventDefault();});$("#merch-property-results .property-overview").each(function(){$(this).find(".save-hotel-link a:first").click(function(e){e.preventDefault();var thisParent=$(this).parent();var o=thisParent.data('info');SaveHotelRemoteService.saveProperty(o.marsha,o.locale,{callback:function(data){switch(data[0]){case"exceedmax":alert(data[2]);break;case"saved":case"notsaved":thisParent.html(data[1]);break;}},timeout:5000,errorHandler:function(message){}});});});});$(function(){var $widget=$('.inline-feedback-widget');var
$trigger=$widget.find('.expand-trigger'),$text=$widget.find('.feedback-text'),$submit=$widget.find('.feedback-submit'),$form=$widget.find('.feedback-form'),$conf=$widget.find('.feedback-confirmation');$trigger.click(function(e){$widget.toggleClass('expanded');e.preventDefault();});var maxLength=$text.attr('maxlength')||500;$text.keyup(function(e){if($text.val()){$submit.removeAttr('disabled');if($text.val().length>maxLength){$text.val($text.val().substr(0,maxLength));}}});$submit.click(function(e){var data={feedback:$text.val(),context:$widget.data('context')};$.ajax({url:'/reservation/feedbackAjax.mi',cache:false,type:'post',data:data,success:function(data){}});$widget.addClass('submitted');});$widget.show();});$(function(){var roomPreferencesURL=$('#js-get-room-preferences').data('url');if(roomPreferencesURL!==undefined&&roomPreferencesURL!=''){$('#js-get-room-preferences').attr('href',roomPreferencesURL);}
myStayRoomPrefereces.toggle();});var myStayRoomPrefereces={toggle:function(isUpdated){var $roomPreferences=$('.m-room-preferences').find('.my-stay-preferences-trigger');var isCollapsible=true;if(($.browser.msie&&$.browser.version=='7.0')||($.browser.msie&&$.browser.version=='8.0')||$('body').hasClass('lt-ie9')){isCollapsible=false;}
if(!isCollapsible){$roomPreferences.each(function(){$(this).children('span').hide();});}else{$roomPreferences.each(function(){var $this=$(this);var roomPreferencesContainer=$this.siblings('.m-room-preferences-container');if(isUpdated&&isUpdated!==undefined){if(!$this.hasClass('open')){$this.addClass('open');$(this).children('span').removeClass('icon-drawer-open').addClass('icon-drawer-close');}
roomPreferencesContainer.show();}else{if(!$this.hasClass('open')){roomPreferencesContainer.hide();}}
$(this).on('click',function(e){fnToggle.click(e,this,roomPreferencesContainer);});});}}}
var rewardsPanel={init:function(){$('#availability-search h3 a').on('click',function(e){e.preventDefault();});var rewardsSection=$("#hidden-rewards-container");var rewardsTrigger=$("#hidden-rewards-trigger a");var useRewardsPoints=$("#useRewardsPoints");var marriottRewardsNumber=$("#marriottRewardsNumber");if((useRewardsPoints.length>0&&useRewardsPoints.is(':checked'))||(marriottRewardsNumber.length>0&&marriottRewardsNumber.val()!=""&&rewardsSection.length>0)||rewardsTrigger.hasClass('open')){rewardsSection.show();rewardsTrigger.addClass("open");}
else{rewardsSection.hide();rewardsTrigger.removeClass("open");}}}
var specialRewardsPanel={init:function(form){if(typeof($(form))!='undefined'){var rChecked=false;var oToggle=$(form).find(":input[name='clusterCode']").each(function(){if($(this).parent().hasClass("js-search-toggleinput")){if($(this).is(':checked')){$(this).parent().find('input:text').show("fast");rChecked=true;}else{$(this).parent().find('input:text').hide("fast");}}
else if($(this).is(':checked')&&$(this).val()!=='none'){rChecked=true;}}).click(function(){$(this).parent().parent().find('.js-search-toggleinput input:text').hide("fast");if($(this).attr("checked")=="checked"){$(this).parent().find('input:text').show("fast");$(this).parent().find('input:text').focus();}});if(form=="#my-stay-search-form"){if(rChecked){$("#hidden-special-rates-trigger a").trigger('click');}
else{$("#hidden-special-rates-container").hide();}}}}}
var fnToggle={click:function(e,obj,container){e.preventDefault();$(obj).toggleClass("open");var $drawer=$(obj).find('span');if($(container).length>0){var toggleContainer=$(container);}
else{var toggleContainer=$(obj).parent().next(".toggle-container:first");}
var hiddenText=$(obj).find('.is-hidden-text[data-o]');if($(obj).hasClass('open')){toggleContainer.attr('aria-expanded',true);toggleContainer.slideDown("fast",function(){$(this).css("overflow","visible");});hiddenText.html(hiddenText.data('o'));$drawer.removeClass('icon-drawer-open').addClass('icon-drawer-close');}
else{toggleContainer.attr('aria-expanded',false);toggleContainer.slideUp("fast");hiddenText.html(hiddenText.data('c'));$drawer.removeClass('icon-drawer-close').addClass('icon-drawer-open');}
return false;}}
var fnGotoPreviousPage={click:function(e){e.preventDefault();window.history.back();}}
$(function(){$('#my-stay-search-form .toggle-container').hide().prev('h3.toggle').toggleClass('active');$('#my-stay-search-form h3.toggle').click(function(){$(this).toggleClass('active').next('.toggle-container').slideToggle();});var useRewardPointCheckbox=$('#my-stay-search-form input[name=useRewardsPoints]');var marriottRewardsNumber=$('#my-stay-search-form input[name=marriottRewardsNumber]');if((useRewardPointCheckbox.length>0&&$(useRewardPointCheckbox+':checked').val()=='true')||(marriottRewardsNumber.length>0&&$(marriottRewardsNumber).val()!='')){$('#reward-panel-content').prev('h3.toggle').click();}
if($('#my-stay-search-form :input[name=clusterCode]').length>0){$('#my-stay-search-form :input[name=clusterCode]:checked').each(function(){if($(this).val()!='none')
{$('#special-rates-container').prev('h3.toggle').click();}});}
$('form.reservation-modify-search-form').submit(function(){var objForm=this;var $fromDateObj=$('#fromDate');var $toDateObj=$('#toDate');var flexibleDateSearch=$(objForm).find(':input[name=flexibleDateSearch]:checked').val();if($fromDateObj.length>0)
{if($fromDateObj.val()=='')
{alert($('#missingcheckInDateMsg').val());$fromDateObj.focus();return false;}}
if($toDateObj.length>0)
{if($toDateObj.val()=='')
{if(flexibleDateSearch!="true")
{alert($('#missingcheckOutDateMsg').val());$toDateObj.focus();return false;}}}
var objClusterCode=$(objForm).find('input[name="clusterCode"]');if(objClusterCode.length>0){var noneRadioButton=$('#none');var groupRatesMessage=$('#groupMessage').val();var useRewardsPtsMessage=$('#useRewardsPtsMessage').val();var groupCodeMsg=$('#groupCodeMsg').val();var corpCodeMsg=$('#corpCodeMsg').val();var awardTypeMsg=$('#awardTypeMsg').val();var redeemAwardMoreRoomMsg=$('#redeemAwardMoreRoomsMsg').val();var redeemAwardOneRoomMsg=$('#redeemAwardOneRoomMsg').val();var flexibleDatesMoreRoomMsg=$('#flexibleDatesMoreRoomMsg').val();var roomNumber=$(objForm).find('#room-num');var corprateCode=$(objForm).find('#corp-code');var groupCode=$(objForm).find('#group-code');var awardNumber=$(objForm).find('#award-number');var specialTextFieldCollection=corprateCode.add(groupCode).add(awardNumber);var groupRadio=$(objForm).find('.search-clusterCode-group');var corpRadio=$(objForm).find('.search-clusterCode-other');var incentiveRadio=$(objForm).find('.search-clusterCode-INT');var useRewardCheckbox=$(objForm).find('.search-useRewardsPoint');var selectedSpecialRate=$(objClusterCode).filter(":checked").val();if($(roomNumber).length>0&&$(roomNumber).val()>=4&&(selectedSpecialRate!="none"&&selectedSpecialRate!="INT"))
{var choice=confirm(groupRatesMessage);if(choice)
{$(specialTextFieldCollection).each(function(){$(this).val('');});noneRadioButton.attr('checked',true);}
return choice;}
if(flexibleDateSearch=="true"&&$(roomNumber).length>0&&$(roomNumber).val()>=4)
{alert(flexibleDatesMoreRoomMsg);return false;}
if(groupRadio.attr('checked')==='checked'&&(groupCode.val()===''||groupCode.val().length<7))
{alert(groupCodeMsg);return false;}
if(corpRadio.attr('checked')==='checked'&&(corprateCode.val()===''||corprateCode.val().length<3))
{alert(corpCodeMsg);return false;}
if(incentiveRadio.attr('checked')==='checked')
{if(awardNumber.val()==='')
{var choice=confirm(awardTypeMsg);if(choice)
{$(specialTextFieldCollection).each(function()
{$(this).val('');});noneRadioButton.attr('checked',true);}
return choice;}
else
{if(roomNumber.val()>=4)
{var choice=confirm(redeemAwardMoreRoomMsg);if(choice)
{$(specialTextFieldCollection).each(function()
{$(this).val('');});noneRadioButton.attr('checked',true);}
return choice;}
else if(roomNumber.val()>1)
{alert(redeemAwardOneRoomMsg);return false;}}}
if(useRewardCheckbox.attr('checked')==='checked'&&roomNumber.val()>=4)
{var choice=confirm(useRewardsPtsMessage);if(choice)
{useRewardCheckbox.attr('checked',false);noneRadioButton.attr('checked',true);}
return choice;}}
return true;});});$(window).load(function(){var myStayCarouselComponent=$('#my-stay-carousel-component');if($(myStayCarouselComponent).length>0)
{function buttonDisable(){if($("#prev-button").hasClass('disabled')){$("#prev-button").attr('src','/Images/HWS_Redesign/boxed_arrow_left_mask_16x14.gif');}else{$("#prev-button").attr('src','/Images/HWS_Redesign/enabled_boxed_arrow_left_mask_16x14.gif');}
if($("#next-button").hasClass('disabled')){$("#next-button").attr('src','/Images/HWS_Redesign/boxed_arrow_right_mask_16x14.gif');}else{$("#next-button").attr('src','/Images/HWS_Redesign/enabled_boxed_arrow_right_mask_16x14.gif');}}
$(myStayCarouselComponent).jCarouselLite({btnNext:"#next-button",btnPrev:"#prev-button",visible:1,circular:false});var prevButton=$("#prev-button");var nextbutton=$("#next-button");prevButton.addClass('disabled');buttonDisable();var ofText;var carouselLength;var current=1;ofText=$(myStayCarouselComponent).data('oftext');carouselLength=$(myStayCarouselComponent).data('length');$('#carousel-indicator').html(current+" "+ofText+" "+carouselLength);$('#next-button').click(function(){if(current<carouselLength)
{current++;}else if(current==carouselLength){nextbutton.addClass('disabled');}
buttonDisable();$('#carousel-indicator').html(current+" "+ofText+" "+carouselLength);});$("#prev-button").click(function(){if(current>1)
{current--;}else{prevButton.addClass('disabled');}
buttonDisable();$('#carousel-indicator').html(current+" "+ofText+" "+carouselLength);});$('#my-stay-carousel-component a').click(function(){var url=$(this).attr('href');WinOpen(url,'','100','200','800','600');return false;});}
var photoCarouselContainer=$('#photo-carousel-module');if($(photoCarouselContainer).length>0)
{$('#photo-carousel-module').css('left',0);}});var myStayPreferencesTabs=$('#my-stay-preferences-tabs');if($(myStayPreferencesTabs).children('p').hasClass('my-stay-preferences-rooms'))
{$(myStayPreferencesTabs).tabs();}
$(function(){var allPossiblePreferencePanelContainers="#room-rate-container,#modify-preferences-form,#change-preferences-section,#change-preferences-section-active,#roomPreferenceForm";$(allPossiblePreferencePanelContainers).preferenceForm();$('.t-edit-dropdown').removeClass('is-visible').addClass('is-hidden');$('.edit-dates-toggle').click(function(e){e.preventDefault();$(this).next('.t-edit-dropdown').toggleClass('is-hidden');$(this).parent().toggleClass("l-padding-bottom-double");});});var sVal=1;var cVal=1;var tVal;var oftext='';if($('[name="of-text"]')){oftext=$('[name="of-text"]').val();}
var roomCarousel={getGlobalImagePath:function(){var path;if($.data){path=$("body").data('imgpath')||"";if(path==""){path=$('#preferencescontainer','body').data('imgpath')||"";}}
else{path="";}
return path;},gatherInfo:function(roomPoolCode){var carouselPhotoList=photoCarouselInfoData[roomPoolCode];var isUndefined=(typeof(window[carouselPhotoList])=="undefined")?true:false;var buildSet='';var globalImgPath=this.getGlobalImagePath();var $photoCarouselModule=$('#preference-panel').find('.photo-carousel-module');if((carouselPhotoList&&carouselPhotoList.length>0)||!isUndefined){$photoCarouselModule.show();buildSet='<ul id="'+roomPoolCode+'">';for(var i=0;i<carouselPhotoList.length;i++){buildSet+='<li><a href="'+carouselPhotoList[i].photoTourPopupPgURL+'" title="'+carouselPhotoList[i].imageAltTag+'"><img src="'+globalImgPath+carouselPhotoList[i].thumbnailImageFile+'" alt="'+carouselPhotoList[i].imageAltTag+'" height="104" width="84"/></a></li>';}
buildSet+='</ul>';cVal=1;tVal=carouselPhotoList.length;roomCarousel.runCarousel(buildSet,roomPoolCode);}
else
{$photoCarouselModule.hide();}},runCarousel:function(buildSet,roomPoolCode){function buttonDisableRooms(){if($("#preference-panel .photo-carousel-prev").hasClass('disabled')){$("#preference-panel .photo-carousel-prev").attr('src','/Images/HWS_Redesign/boxed_arrow_left_mask_16x14.gif');}else{$("#preference-panel .photo-carousel-prev").attr('src','/Images/HWS_Redesign/enabled_boxed_arrow_left_mask_16x14.gif');}
if($("#preference-panel .photo-carousel-next").hasClass('disabled')){$("#preference-panel .photo-carousel-next").attr('src','/Images/HWS_Redesign/boxed_arrow_right_mask_16x14.gif');}else{$("#preference-panel .photo-carousel-next").attr('src','/Images/HWS_Redesign/enabled_boxed_arrow_right_mask_16x14.gif');}}
$('#preference-panel .photo-carousel-next, #preference-panel .photo-carousel-prev').unbind('click');var carouselLoad=$('#preference-panel .photo-carousel ul').replaceWith(buildSet);$('#preference-panel .photo-carousel').show();$('#preference-panel .photo-carousel').jCarouselLite({visible:1,btnNext:"#preference-panel .photo-carousel-next",btnPrev:"#preference-panel .photo-carousel-prev",circular:false});$('#preference-panel .photo-carousel-prev').addClass('disabled');buttonDisableRooms();$('.photo-carousel').width('84px').find('li').height('107px').width('84px');roomCarousel.photosPopUp();var startingVals=$("#preference-panel .photo-carousel-control").html(cVal+' '+oftext+' '+tVal);if(tVal==1){$('#preference-panel .photo-carousel-next').addClass('disabled');buttonDisableRooms();}
$('#preference-panel .photo-carousel-next').click(function(){if(cVal<tVal){cVal++;}
buttonDisableRooms();$("#preference-panel .photo-carousel-control").html(cVal+' '+oftext+' '+tVal);});$('#preference-panel .photo-carousel-prev').click(function(){if(cVal>1){cVal--;}
buttonDisableRooms();$("#preference-panel .photo-carousel-control").html(cVal+' '+oftext+' '+tVal);});$('#preference-panel .photo-carousel').hide();},photosPopUp:function(){if(!this.clicksRegistered){$('#preference-panel').on({'click':function(evt){evt.preventDefault();var url=$(this).attr('href');WinOpen(url,'','100','200','800','600');}},'.photo-carousel-module a',null);this.clicksRegistered=true;}}};$.widget("miUi.preferenceForm",{options:{"alerts":{},"dirtyInputs":{"savable":[],"nonSavable":[]},"featherFreeMsg":$("#feather-free-msg").val(),"numberOfRooms":$("#numberOfRooms").val(),"roomPreferenceData":null,"$roomPreferenceTabs":$("#preferencescontainer"),"signedIn":($("#saveBillingInformationDiv").length>0||$(".js-user-singed-in").length>0),"form1Selector":':input[id$="1"]',"initRoomPreferences":$("#preferencescontainer").data('initpreferences'),"warningMsg":$('.js-feather-free-msg').is(':visible')},_create:function(){var panel=this.element;var filter=this.options.form1Selector;var $roomPrefTabs=this.options.$roomPreferenceTabs;var signedIn=this.options.signedIn;var $self=this;if(signedIn){if($roomPrefTabs.length>0){$roomPrefTabs.tabs({select:$.proxy(this,"_prefTabSelect")});}
else{roomPrefTabs=$($roomPrefTabs.selector).tabs({select:$.proxy(this,"_prefTabSelect")});}
panel.on({'change.preferenceForm':$.proxy(this,"checkSavable"),'checkDirty.preferenceForm':$.proxy(this,"_checkDirty"),"inputInitialize.preferenceForm":$.proxy(this,"_inputInitialize")},filter,null);RoomPreferencesRemoteService.getNonSavableAlertMessaging("#"+this.element.attr("id"),{callback:function(dataFromServer){dataFromServer["C2"]=dataFromServer["crib"];dataFromServer["R1"]=dataFromServer["rollaway"];dataFromServer["E1"]=dataFromServer["early"];$(dataFromServer["#id"]).preferenceForm("option",{"alerts":dataFromServer});},errorHandler:function(dataFromServer){},timeout:5000});}else{if($roomPrefTabs.length>0){$roomPrefTabs.tabs();}else{$($roomPrefTabs.selector).tabs();}}
panel.on({'click.preferenceForm':$.proxy(this,"_featherFree")},'.featherFree',null);panel.on({'change.preferenceForm':$.proxy(this,"_pillowFeatherFree")},'.pillows',null);panel.closest("form[name='preferencesForm']").on({'submit.preferenceForm':$.proxy(this,"sGo")},null,null);panel.find('noscript').each(function(){$(this).remove();});if(panel.find("#number-of-rooms").val()>1){panel.find('#m-copy-selections').show();}
panel.on('change.preferenceForm',function(){$self._copySelections();});if($('h3.heading.hidden',panel).length>0){$('h3.heading',panel).removeClass('hidden');}
if($('#change-preferences-section',panel).length>0&&$('.room-preferences option',panel).length>1){$('.room-preferences',panel).removeClass('hidden');}},_copySelections:function()
{if($('#copy-selections-to-all').is(':checked'))
{var n=$('#preferencescontainer li.ui-tabs-selected>a').attr('id');var n=n.charAt(n.length-1);$('.early').each(function(){$(this).prop('checked',$('#early'+n).prop('checked'));});$('.extraTowels').each(function(){$(this).prop('checked',$('#extraTowels'+n).prop('checked'));});$('.featherFree').each(function(){$(this).prop('checked',$('#featherFree'+n).prop('checked'));});$('.roompreference').each(function(){$(this).prop('selectedIndex',$('#roomPreference'+n).prop('selectedIndex'));});$('.pillows').each(function(){$(this).prop('selectedIndex',$('#pillow'+n).prop('selectedIndex'));});$('.floor-level-options').each(function(){$(this).prop('selectedIndex',$('#location'+n).prop('selectedIndex'));});if(document.getElementById("hotelNotMB")){$('.rollaway').each(function(){$(this).prop('selectedIndex',$('#rollaway'+n).prop('selectedIndex'));});}}},checkSavable:function()
{$('#copy-selections-to-all',this.element).prop('checked',false);var panel=this.element;var filter=this.options.form1Selector;panel.find(filter).trigger("checkDirty");var data=this.options.dirtyInputs;this.displaySavableMsg((data.savable.length>0),data.nonSavable);this.options.dirtyInputs={"savable":[],"nonSavable":[]};console.log(this.options.dirtyInputs);},displaySavableMsg:function(savable,partialSavableJson){var savableMsg=$("#savable-preference-msg");var buttons=$("#preferences-container-buttons");if(savableMsg.length>0)
{if(savable){savableMsg.show();this.togglePartialSavableDisclaimer(true,partialSavableJson);}else{savableMsg.hide();this.togglePartialSavableDisclaimer(false,partialSavableJson);}}},togglePartialSavableDisclaimer:function(isVisible,partialSavableArray){var partialSavableDisclaimer=$("#partial-savable-preference-msg",this.element);if(isVisible&&partialSavableArray.length>0){partialSavableDisclaimer.show();var uls=$("ul",partialSavableDisclaimer);var liMaster=$("<li></li>");uls.empty();for(var labelIndex in partialSavableArray){var li=liMaster.clone().append(partialSavableArray[labelIndex]);$(uls[labelIndex%uls.length]).append(li);}}else{partialSavableDisclaimer.hide();}},sGo:function(){this.validateForm();},validateForm:function(){var panel=this.getPanel();panel.find('#preferences-form select').each(function(index,elem){if($(this).prop('selectedIndex').val()=='none'){$(this).prop('selectedIndex').val('');}});},_checkDirty:function(evt){var $input=$(evt.target);var profPreference=$input.data('profilePreference');var prefdata=this.options.dirtyInputs;var value=$input.val();if(typeof(profPreference)!="undefined"){if($input.is(":checkbox,:radio")){if(profPreference.nonSavable[value]&&$input.prop("checked")){if($.inArray(profPreference.nonSavable[value],prefdata.nonSavable)==-1){prefdata.nonSavable.push(profPreference.nonSavable[value]);}}else if((profPreference.savable[value]&&!$input.prop("checked"))||(!profPreference.savable[value]&&$input.prop("checked"))){if($.inArray($input.attr("id")+" "+value,prefdata.savable)==-1){prefdata.savable.push($input.attr("id")+" "+value);}}}else{var matches=0;for(var possible in profPreference.savable){if(value.indexOf(possible)>-1){matches+=1;}}
for(var possible in profPreference.nonSavable){if(value.indexOf(possible)>-1){if($.inArray(profPreference.nonSavable[possible],prefdata.nonSavable)==-1){prefdata.nonSavable.push(profPreference.nonSavable[possible]);matches+=1;}}}
if(matches*2<value.length){if($.inArray($input.attr("id")+" "+value,profPreference.savable)==-1){prefdata.savable.push($input.attr("id")+" "+value);}}}
this.options.dirtyInputs=prefdata;}},_inputInitialize:function(evt){var input=$(evt.target);var savablePreferences=this.options.initRoomPreferences;if(savablePreferences==undefined){savablePreferences=$("#preferencescontainer").data('initpreferences');}
var nonSavablePreferences=this.options.alerts;if(nonSavablePreferences&&savablePreferences&&savablePreferences.reservationPreferences){savablePreferences=savablePreferences.reservationPreferences;var suffix='ValueOnLoad';var profPreference=input.data('profilePreference');if(!profPreference){profPreference={"savable":{},"nonSavable":{}};}
if(input.is(":checkbox,:radio")){var value=input.val();var found=false;for(var alertCode in nonSavablePreferences){if(alertCode==value){profPreference.nonSavable[alertCode]=nonSavablePreferences[alertCode];found=true;break;}}
if(!found){for(var prefCode in savablePreferences){if(prefCode==value){profPreference.savable[prefCode]=savablePreferences[prefCode];break;}}}}else if(input.is("select")){for(var prefCode in savablePreferences){var savableFound=input.find("option[value*='"+prefCode+"']").length;if(savableFound>0){profPreference.savable[prefCode]=savablePreferences[prefCode];}}
for(var alertCode in nonSavablePreferences){var nonSavableFound=input.find("option[value*='"+alertCode+"']").length;if(nonSavableFound>0){profPreference.nonSavable[alertCode]=nonSavablePreferences[alertCode];}}}
input.data('profilePreference',profPreference);$("#"+input.attr("id")+suffix).val(input.val());}},_featherFree:function(evt){var featherFree=$(evt.target);var $fFParent=featherFree.parents('.preference-form');var roomReferences=featherFree.attr('id').substring(11);var pillows=$fFParent.find('#pillow'+roomReferences);var featherFreeLen=$(".js-feather-free-msg").length;var featherFreeMsg=$fFParent.find(".js-feather-free-msg");var warningMsgDisplayed=(this.options.warningMsg,this.element);if(featherFreeLen>0){if(featherFree.prop('checked')&&pillows.val()=="V9"){featherFreeMsg.removeClass("is-hidden");featherFree.prop("checked",false);}else if(featherFree.prop('checked')&&pillows.val()!="V9"&&warningMsgDisplayed){featherFreeMsg.addClass("is-hidden")}}else if(featherFree.prop('checked')&&pillows.val()=="V9"){if(this.options.featherFreeMsg){alert(this.options.featherFreeMsg);featherFree.prop("checked",false);}}
if(featherFree.prop('checked')==false&&pillows.val()!="V9"&&featherFreeLen>0){featherFreeMsg.addClass("is-hidden");}
warningMsgDisplayed=void 0;},_pillowFeatherFree:function(evt){var pillows=$(evt.target);var $pillowParent=pillows.parents('.preference-form');var roomReferences=pillows.attr('id').substring(6);var featherFree=$pillowParent.find('#featherFree'+roomReferences);var featherFreeLen=$(".js-feather-free-msg").length;var featherFreeMsg=$pillowParent.find(".js-feather-free-msg");var warningMsgDisplayed=this.options.warningMsg;if(featherFreeLen>0){if(featherFree.prop('checked')&&pillows.val()=="V9"){featherFreeMsg.removeClass("is-hidden");featherFree.prop("checked",true);pillows.prop("selectedIndex",'0');}else if(featherFree.prop('checked')&&pillows.val()!="V9"&&warningMsgDisplayed){featherFreeMsg.addClass("is-hidden");}}else if(featherFree.prop('checked')&&pillows.val()=="V9"){if(this.options.featherFreeMsg){alert(this.options.featherFreeMsg);pillows.prop("selectedIndex",'0');}}
if(pillows.val()!="V9"&&featherFree.prop('checked')==false&&featherFreeLen>0){featherFreeMsg.addClass("is-hidden");}
warningMsgDisplayed=void 0;},_prefTabSelect:function(evt,ui){var $eventTarget=$(evt.target);if(ui.index!=0){this.displaySavableMsg(false,[]);}else{this.checkSavable();}},_redrawRoomPreferences:function(data){var roomPreferencesList=data;var preferencesBlock=this.element;var newSelects=$('select[id^="roomPreference"]',preferencesBlock);newSelects.each(function(index,elem){var select=$(this);var selectedInPrevStep=select.find(":selected").clone();var noPreference=select.find("option[value='']").clone();var selectedOverride=false;if(noPreference.val()!=selectedInPrevStep.val()){selectedOverride=true;}
select.empty();select.append(noPreference);if(roomPreferencesList){for(var i=0;i<roomPreferencesList.length;i++){var option=$("<option value='"+roomPreferencesList[i].preferenceCode+"'>"+roomPreferencesList[i].preferenceMessage+"</option>");if((selectedOverride&&option.val()==selectedInPrevStep.val())||(!selectedOverride&&roomPreferencesList[i].matchesSavedPreference==true&&select.is("[id$='1']"))){option.prop("selected",true);noPreference.prop("selected",false);}
select.append(option);}}
select.closest(".preference-form").find(".room-preferences").removeClass("hidden");});if(this.options.signedIn){this.element.find(this.options.form1Selector).trigger("inputInitialize");this.checkSavable();}},_setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments);},_setOption:function(key,value){$.Widget.prototype._setOption.call(this,key,value);if(/roomPreferenceData/.test(key)){this._redrawRoomPreferences(value);}
if(/alerts/.test(key)&&value){this.element.find(this.options.form1Selector).trigger("inputInitialize");this.checkSavable();}}});$(function(){if($('#credit-card-section').length>0){var saveblePreferenceMsgDiv=$('#creditCardSavebleMsgDiv');var nameOnCC=$('#name-on-cc');var ccNickNameAndPurpose=$('#cc-nick-name, #purpose');var usePreferencePlus=$('#use-preference-plus');var creditCardChargeMsg=$('#credit-card-charge-message');var purchasePoints=$('#purchase-points');var selectedCreditCardType=$('#credit-card-type-hidden');$("#credit-card-number").attr("autocomplete","off");$("#credit-card-number").attr("pattern","[0-9]*");saveblePreferenceMsgDiv.hide();guestInfoCreditCardType.init();MI.Util.DialogBox(".js-credit-card-popover");if($('#display-credit-from-file-hidden').val()=='true'){nameOnCC.hide();}
else{nameOnCC.show();}
var selectCreditCard=$('#select-credit-card input[name=selectedCreditCard]');if(selectCreditCard.length>0){if(selectCreditCard.val()=='E'){ccNickNameAndPurpose.hide();nameOnCC.show();}}
var savableCreditCardInfoChanged=function(){var preferePlusSelection=$('#preference-selection input[name=paymentType]:checked');var selectedCreditCard=$('#select-credit-card input[name=selectedCreditCard]:checked');if((usePreferencePlus.length>0&&preferePlusSelection.length>0&&preferePlusSelection.val()=='P')||(selectedCreditCard.length>0&&selectedCreditCard.val()=="E")){saveblePreferenceMsgDiv.hide();}
else{if(saveblePreferenceMsgDiv.length>0&&selectedCreditCardType.val()!="UP"){if((selectedCreditCard.length<=0)||(selectedCreditCard.length>0&&selectedCreditCard.val()!="E"))
{saveblePreferenceMsgDiv.show();}}}};var saveCreditCardFieldObj=$('#saveCreditCardField');if(saveCreditCardFieldObj.length>0&&saveCreditCardFieldObj.is(':checked'))
{savableCreditCardInfoChanged();}
var billingFormElementsChange=$('#exp-month, select#exp-year, .l-tabular-date');if(billingFormElementsChange.length>0)
{billingFormElementsChange.bind("change click",savableCreditCardInfoChanged);}
var billingFormElementsPressed=$('#credit-card-nickname, #credit-card-number');if(billingFormElementsPressed.length>0)
{billingFormElementsPressed.bind("keydown",savableCreditCardInfoChanged);}
var purposeElements=$('p#purpose input[name=purpose]');if(purposeElements.length>0)
{purposeElements.bind("click",savableCreditCardInfoChanged);}
if(usePreferencePlus.length>0&&usePreferencePlus.is(':checked')){saveblePreferenceMsgDiv.hide();}
usePreferencePlus.click(function(){if(saveblePreferenceMsgDiv.length>0){if(saveCreditCardFieldObj.length>0)
{saveCreditCardFieldObj.attr('checked',false);}
saveblePreferenceMsgDiv.hide();}});var creditCardInvalidMsg=$('#invalid-credit-card-msg-hidden');var validateCCName=function(){var nameOnCreditCardObj=$('#credit-card-name');if(nameOnCreditCardObj!=null&&nameOnCreditCardObj.length>0){var nameOnCreditCard=nameOnCreditCardObj.val();var numbers="0123456789";var length=nameOnCreditCard.length;for(i=0;i<length;i++){if(numbers.indexOf(nameOnCreditCard.charAt(i))!=-1){alert(creditCardInvalidMsg.val());nameOnCreditCardObj.val("");setTimeout(function(){nameOnCreditCardObj.focus();},5)
return false;}}}
return true;};var validateCCNickNameAndAlert=function(){var ccNickNameObj=$('#credit-card-nickname');if(ccNickNameObj.length>0&&ccNickNameObj.val().length>14){var ccNickName=ccNickNameObj.val();var nameRegExp=/[A-Za-z]/;if(!nameRegExp.test(ccNickName)){alert(creditCardInvalidMsg.val());ccNickNameObj.val("");setTimeout(function(){ccNickNameObj.focus();},5)
return false;}}
return true;}
var setSelectedOption=function(obj,value){if(obj.find('option:selected').val()!=value)
{obj.find('option:first').attr("selected","selected");}};$('#credit-card-name').bind("click change",validateCCName);$('#credit-card-nickname').bind("click change",validateCCNickNameAndAlert);preferCredit=$('#preferredCreditCard');if(preferCredit.length>0){preferCredit.removeClass('hidden');}
otherCredit=$('#otherCreditCard');if(otherCredit.length>0){otherCredit.removeClass('hidden');}
enterCredit=$('#enterCreditCard');if(enterCredit.length>0){enterCredit.removeClass('hidden');}
alternateCredit=$('#alternateCreditCard');if(alternateCredit.length>0){alternateCredit.removeClass('hidden');}
var selectedCreditCard=$('#select-credit-card input[name=selectedCreditCard]');if(selectedCreditCard.length>0){selectedCreditCard.click(function(){var creditCardNickName=$('#credit-card-nickname');var checkedCreditCardValue=$(this).val();var creditCardType=$('#credit-card-type-hidden');var creditCardNumber=$('#credit-card-number');var expMonth=$('#exp-month');var expYear=$('#exp-year');var expMonthTab=$('.l-exp-month-tab');var expYearTab=$('.l-exp-year-tab');var purposeGroup=$('p#purpose input[name=purpose]');ccNickNameAndPurpose.show();nameOnCC.hide();var selectedAlias="";var selectedCreditCardType="";var selectedCreditCardNumber="";var selectedExpMonth="";var selectedExpYear="";var selectedPurpose="";if(checkedCreditCardValue=="P"||checkedCreditCardValue=="O"){if(checkedCreditCardValue=="P"){selectedAlias=$('#preferred-card-alias').val();selectedCreditCardType=$('#preferred-card-vendor-code').val();selectedCreditCardNumber=$('#preferred-card-number').val();selectedExpMonth=$('#preferred-card-exp-month').val();selectedExpYear=$('#preferred-card-exp-year').val();selectedPurpose=$('#preferred-card-purpose').val();}
else if(checkedCreditCardValue=="O"){selectedAlias=$('#other-card-alias').val();selectedCreditCardType=$('#other-card-vendor-code').val();selectedCreditCardNumber=$('#other-card-number').val();selectedExpMonth=$('#other-card-exp-month').val();selectedExpYear=$('#other-card-exp-year').val();selectedPurpose=$('#other-card-purpose').val();}}
else if(checkedCreditCardValue=="E"||checkedCreditCardValue=="A"){if(checkedCreditCardValue=="E")
{ccNickNameAndPurpose.hide();nameOnCC.show();if(saveCreditCardFieldObj.length>0)
{saveCreditCardFieldObj.attr('checked',false);}
if(saveblePreferenceMsgDiv.length>0){saveblePreferenceMsgDiv.hide();}}
selectedPurpose="B";var hiddenCreditCard=$("#hidden-credit-card");if(hiddenCreditCard.length&&hiddenCreditCard.length>0){var hiddenSelectedCreditCard=hiddenCreditCard.val();if(hiddenSelectedCreditCard!="P"&&hiddenSelectedCreditCard!="O"){selectedAlias=$('#hidden-credit-card-alias').val();selectedCreditCardType=$('#hidden-credit-card-vendor-code').val();selectedCreditCardNumber=$('#hidden-credit-card-number').val();selectedExpMonth=$('#hidden-credit-card-exp-month').val();selectedExpYear=$('#hidden-credit-card-exp-year').val();selectedPurpose=$('#hidden-credit-card-purpose').val();}}}
creditCardNickName.val(selectedAlias);creditCardType.val(selectedCreditCardType);if(creditCardType.val()!=''){var $selectedCreditCard=$('#credit-card-type li img#'+selectedCreditCardType);var altText="";$("#credit-card-type li img").each(function(){altText=$(this).data('options').accept;$(this).removeClass('unselected').addClass('unselected').attr('title',altText).attr('alt',altText);});altText=$selectedCreditCard.data('options').selected;$selectedCreditCard.removeClass("unselected").attr('title',altText).attr('alt',altText);}else{$("#credit-card-type li img").each(function(){var altText=$(this).data('options').accept;$(this).removeClass('unselected').attr('title',altText).attr('alt',altText);});}
creditCardNumber.val(selectedCreditCardNumber);expMonth.val(selectedExpMonth);expMonthTab.find('li.is-active').removeClass('is-active');expMonthTab.find('[data-date = '+selectedExpMonth+']').parent('li').addClass('is-active');setSelectedOption(expMonth,selectedExpMonth);expYear.val(selectedExpYear);expYearTab.find('li.is-active').removeClass('is-active');expYearTab.find('[data-date = '+selectedExpYear+']').parent('li').addClass('is-active');setSelectedOption(expYear,selectedExpYear);$('p#purpose input[name=purpose][value='+selectedPurpose+']').attr('checked',true);});}
$('#guest-payment-form, #modify-payment-form').submit(function(){validateCCName();});creditCardChargeMsg.hide();if(purchasePoints.length>0&&purchasePoints.is(':checked')){creditCardChargeMsg.show();}
$('#attach-cert, #purchase-points, #do-nothing').click(function(){if($(this).val()=='PurchasePoints'){creditCardChargeMsg.show();}
else{creditCardChargeMsg.hide();}});var purchasePointsCheckBox=$('#redemption-payment-options #purchase-points-check');if(purchasePointsCheckBox.length>0&&!purchasePointsCheckBox.is(':checked'))
{$('#guest-payment-submit').hide();}
purchasePointsCheckBox.click(function(){$('#guest-payment-submit').toggle();creditCardChargeMsg.toggle();});$('#guest-payment-submit, #modiy-payment-form .submit').click(function(){var submit=true;submit=validateCCName();if(!submit){return submit;}
submit=validateCCNickNameAndAlert();if(!submit){return submit;}
return true;});}
var $bothForms=$('#credit-card-section,#enrollment-billing-section');if($bothForms.length>0){function updateReservationMethodUI(){var checked=$('#use-preference-plus').is(':checked');var $inputs=$bothForms.find('input,select');$bothForms.toggleClass('pp-override',checked);if(checked){$('#credit-card-section').css('min-height','120px');$inputs.attr('disabled','disabled');}else{$inputs.removeAttr('disabled');$('#credit-card-section').css('min-height','0');}}
updateReservationMethodUI();$('#use-preference-plus').change(updateReservationMethodUI);$('#cc-form-shield-dismiss').click(function(){$('#use-preference-plus').removeAttr('checked');$('#use-preference-plus').trigger('change');});$('.js-cc-form-shield-dismiss').unbind().click(function(){$('#use-preference-plus').removeAttr('checked');$('#use-preference-plus').trigger('change');});}});var guestInfoCreditCardType={init:function(settings){guestInfoCreditCardType.setup();},setup:function(){guestInfoCreditCardType.initializeCardType();$("#credit-card-number").on("keyup blur input",function(){if($("#credit-card-number").val()!=$("#credit-card-mask").val()){guestInfoCreditCardType.populateCreditCardType();}else{var ccTypeSelected="";if($("#credit-card-type li img.unselected").length>0){ccTypeSelected=$("#credit-card-type li img").not(".unselected").attr("id");}
if(ccTypeSelected!=$("#credit-card-type-hidden").val()||$("#credit-card-number").val()==""){$("#credit-card-type li img").removeClass('unselected');}}});},cardType:function(){var Cards=[];Cards[0]=["Mastercard",[51,52,53,54,55],[16],"MC"];Cards[1]=["Visa",[4],[16],"VS"];Cards[2]=["Amex",[34,37],[15],"AX"];Cards[3]=["DinersClub",[30,36,38,39],[14,16],"DC"];Cards[4]=["Discover",[60110,60112,60113,60114,601174,601177,601186,601187,601188,601189,60119,644,65],[16],"DS"];Cards[5]=["JCB",[352,353,354,355,356,357,358],[16],"JC"];Cards[6]=["UnionPay",[62],[16],"UP"];return Cards;},propertyAcceptedCreditCard:function(){var propertyCreditCardList=[];$("#credit-card-type li img").each(function(){propertyCreditCardList.push($(this).attr("id"));});return propertyCreditCardList;},populateCreditCardType:function(){var ccVal=$("#credit-card-number").val();var ccLength=$("#credit-card-number").val().length;var ccFound=false;var Cards=guestInfoCreditCardType.cardType();var $currentCreditCardType=$("#credit-card-type-hidden");if(ccLength!=0){for(var i=0;i<7;i++){for(var n=0;n<Cards[i][1].length;n++){var cardNum=Cards[i][1][n];var ccShort=parseFloat(ccVal.substr(0,cardNum.toString().length));if($.inArray(ccShort,Cards[i][1])>=0){var acceptedCreditCard=guestInfoCreditCardType.propertyAcceptedCreditCard();if($.inArray(Cards[i][3],acceptedCreditCard)>=0){var selectedCard=$('#credit-card-type li img#'+Cards[i][3]);var altText="";$('#credit-card-type li img').each(function(){altText=$(this).data('options').accept;$(this).removeClass('unselected').addClass('unselected').attr('title',altText).attr('alt',altText);});altText=selectedCard.data('options').selected;selectedCard.removeClass("unselected").attr('title',altText).attr('alt',altText);$currentCreditCardType.val(Cards[i][3]);ccFound=true;}
break;}}}}
if(!ccFound){$('#credit-card-type li img').each(function(){var altText=$(this).data('options').accept;$(this).removeClass('unselected').attr('title',altText).attr('alt',altText);$currentCreditCardType.val("");});}},initializeCardType:function(){var $currentCreditCardType=$("#credit-card-type-hidden");var $creditCardNumber=$("#credit-card-number");var acceptedCreditCard=guestInfoCreditCardType.propertyAcceptedCreditCard();if($currentCreditCardType.val()&&$creditCardNumber.val()&&$.inArray($currentCreditCardType.val(),acceptedCreditCard)>=0){var $selectedCreditCard=$('#credit-card-type li img#'+$currentCreditCardType.val());$('#credit-card-type li img').each(function(){var altText=$(this).data('options').accept;$(this).removeClass('unselected').addClass('unselected').attr('title',altText).attr('alt',altText);});$selectedCreditCard.removeClass('unselected').attr('title',$selectedCreditCard.data('options').selected).attr('alt',$selectedCreditCard.data('options').selected);}}};$(function(){var $guestInfoFormNoValidate=$("#guest-payment-form, #modify-guest-info-form");$guestInfoFormNoValidate.attr("novalidate","novalidate");$('#comment-box').bind("click keypress",function(){if($(this).val().length>45){$(this).val($(this).val().substring(0,45));}});$('#edit-dates').click(function(e){var confirmEdit=$(this).data('edit');if(confirmEdit!==undefined||confirmEdit=='dates'){var url='/reservation/editDatesConfirmation.mi?edit=dates';WinOpen(url,'','300','300','360','200');return false;}});if($('#guest-payment-form').length>0||$('#guest-info-container').length>0)
{var saveblePreferenceMsgDiv=$('#guestInfoSaveblePreferenceMsgDiv');var savebleNameAndEmailMsgDiv=$('#guestInfoNameAndEmailDiv');var savableGuestInfoChanged=function(){if(saveblePreferenceMsgDiv.length>0)
{saveblePreferenceMsgDiv.show();}}
var savableNameAndEmailChanged=function(){if(savebleNameAndEmailMsgDiv.length>0)
{savebleNameAndEmailMsgDiv.show();}}
saveblePreferenceMsgDiv.hide();savebleNameAndEmailMsgDiv.hide();var saveGuestInformationObj=$('#saveGuestInformation');if(saveGuestInformationObj.length>0&&saveGuestInformationObj.is(':checked')){savableGuestInfoChanged();}
var saveNameAndEmailObj=$('#saveNameAndEmail');if(saveNameAndEmailObj.length>0&&saveNameAndEmailObj.is(':checked')){savableNameAndEmailChanged();}
var selectedEmailAddressObj=$("input[name='selectedEmailAddress']");var alternateEmailObj=$('#alternate-email-text');var resEmailObj=$('#res-email-hidden');var email=$('#email-hidden');if(selectedEmailAddressObj.length>0){selectedEmailAddressObj.bind('click change',function(){if(selectedEmailAddressObj.is(':checked')){var selectedEmailAddress=$(this).val();var primaryEmail=$('#primary-email-hidden').val();var alternateEmailAddress=$('#alternate-email-text').val();var alternateEmail=$('#alternate-email-hidden').val();if(selectedEmailAddress=="PE"){email.val(primaryEmail);if(resEmailObj.length>0){alternateEmailObj.val(resEmailObj.val());}
else{alternateEmailObj.val(alternateEmail);}}
else if(selectedEmailAddress=="SE"){email.val(alternateEmailAddress);}}});}
var alternateEmailChanged=function(){var alternateEmail=$(this).val();$("input[name='selectedEmailAddress'][value='SE']").attr('checked',true);email.val(alternateEmail);}
alternateEmailObj.bind("click change focus",alternateEmailChanged);var guestInfoFormElements=$('#company-name, #address-line1, #in-address-line1, #address-line2, #in-address-line2, #city, #in-city, #state, #non-us-state, #country, #postal-code');if(guestInfoFormElements.length>0)
{guestInfoFormElements.bind("change",savableGuestInfoChanged);}
var guestInfoFormEmailElements=$('#alternate-email-text, #email');if(guestInfoFormEmailElements.length>0)
{guestInfoFormEmailElements.bind("change",savableNameAndEmailChanged);}}
$('#enroll-link,#guestinfo-join-mr-link, #enroll-now-text a').click(function(event){var enrollMRForm=document.getElementById('guest-payment-form');var enrollAction=$(this).attr('href');if(enrollMRForm&&enrollAction&&enrollAction.length>0)
{enrollMRForm.action=enrollAction;enrollMRForm.submit();return false;}
else
{return true;}});function guestInfoSignInPanelDialog(){var $form=$('[name=directLoginForm]:first');if($('#remember-me').is(':checked')){$form.find('input:hidden[name=rememberMe]').val('true');}else{$form.find('input:hidden[name=rememberMe]').val('false');}
var closeText=msgResources.closeText||'Close';var loadingText=msgResources.loadingText||'Loading...';$.magnificPopup.open({mainClass:'m-modal t-modal-med l-signin-modal l-signin-guestInfo',items:{src:'.m-sign-in-panel',type:'inline'},closeMarkup:'<div class="m-modal-utilities t-blck">'
+'<button class="m-modal-close mfp-close is-hover-fix">%title%<i class="icon mfp-close icon-close"></i></button>'
+'</div>',tClose:closeText,tLoading:loadingText,callbacks:{beforeOpen:function(){this.container.attr('aria-live','assertive');$('#page-container').attr('aria-hidden','true');},open:function(){$('.js-guest-btn').on('click',function(e){e.preventDefault();$.magnificPopup.close();});},close:function(){$('#page-container').removeAttr('aria-hidden');}}});$('#sign-in-button').on('click',function(){if($('#user-id'))
{$form.find('input:hidden[name=userID]').val($('#user-id').val());}
$form.find('input:hidden[name=password]').val($('#password').val());$form.append('<input type="hidden" name="errorUrl" value="/signInError.mi" />');$form.find('input:hidden[name=accountWidgetRequest]').val($(':hidden[name="accountWidgetRequest"]').val());if($('#remember-me').is(':checked'))
{$form.find('input:hidden[name=rememberMe]').val('true');$form.append('<input type="hidden" name="rememberMe" value="true" />');}
else
{$form.find('input:hidden[name=rememberMe]').val('false');$form.append('<input type="hidden" name="rememberMe" value="false" />');}
$form.submit();});}
if((!$("#sign-in-trigger").hasClass('has-no-popover'))&&($("#sign-in-trigger").hasClass('showDialog')||$("#guest-payment-container form[name=directLoginForm]").hasClass('m-sign-in-panel'))){guestInfoSignInPanelDialog();}
$(".js-rz-sign-in-trigger").on('click',function(e){e.preventDefault();guestInfoSignInPanelDialog();});$("#guest-info-sign-in-panel a.remember-me-tooltip-link").hover(function(){$('.remember-me-tooltip').toggleClass('show');var targetPosSignInWindow=$('#guest-info-sign-in-panel').offset();var targetPos=$(this).offset();var tooltipHeight=$(".remember-me-tooltip").height();$(".remember-me-tooltip").css({"top":(targetPos.top-targetPosSignInWindow.top)-(tooltipHeight+20)+"px","left":(targetPos.left-targetPosSignInWindow.left-160)+"px"});});$("#guest-info-sign-in-panel a.remember-me-tooltip-link").click(function(event){event.preventDefault();});$('.login-decline').click(function(){$('#close-link-label').trigger('click');})
smsInfo.init();addressInfoByContry.init();guestInfoInlineJoinNow.init();guestInfoCardHolderName.init();dataBindingCC.init();var isCombo=$("#guest-country").is("select"),CountryCode=isCombo?$("#guest-country option:selected").val():$("#country").val(),notMvciUrl=windowURL.match('mvci')?false:true;if(typeof CountryCode!=="undefined"&&notMvciUrl){addressInfoByContry.callGC($("#js-guestinfo-join-panel"),CountryCode);}});var dataBindingCC={config:{expMonth:$('.l-exp-month-tab a'),expYear:$('.l-exp-year-tab a'),expMonthDropDown:$('.js-exp-month'),expYearDropDown:$('.js-exp-year'),},init:function(settings){var $self=dataBindingCC.config;$.extend($self,settings);dataBindingCC.creditCardInfo($self.expMonth,$self.expMonthDropDown);dataBindingCC.creditCardInfo($self.expYear,$self.expYearDropDown);},creditCardInfo:function($obj,$dropDown){dataBindingCC.dropdownToTabBinding($obj,$dropDown);$obj.on('click',function(e){e.preventDefault();var activeParent=$obj.parent('li.is-active');var mainContainer=$(this).parent('li');var dropDownValue=$(this).attr("data-date");activeParent.removeClass('is-active');mainContainer.addClass('is-active');$dropDown.find('option').removeAttr('selected','true');$dropDown.find('option[value="'+dropDownValue+'"]').attr('selected','true');});$dropDown.on('change',function(){dataBindingCC.dropdownToTabBinding($obj,$dropDown);});},dropdownToTabBinding:function($obj,$dropDown){var activeParent=$obj.parent('li.is-active');activeParent.removeClass('is-active');var selectedOption=$dropDown.find('option:selected').val();$obj.filter('[data-date = '+selectedOption+']').parent('li').addClass('is-active');}};var smsInfo={config:{$items:$("#sms-checkbox"),$container:$("#sms-toggle-container"),$smsToggleLink:$('#sms-toggle-link')},init:function(settings){$.extend(smsInfo.config,settings);if(smsInfo.config.$items.length>0&&smsInfo.config.$smsToggleLink.data('smscheck')=='Y'){smsInfo.config.$container.show();}
else{smsInfo.config.$container.hide();}
smsInfo.setup();},setup:function(){smsInfo.config.$items.on("change",function(){if($(this).prop("checked")){smsInfo.config.$container.show();}
else{smsInfo.config.$container.hide();$("#sms-phone-number").val("");}});}};var addressInfoByContry={config:{$items:$("#guest-country"),$container:$("#address-section-container"),$guestInfoContainer:$("#js-guestinfo-join-panel"),$notMvciUrl:windowURL.match('mvci')?false:true},init:function(settings){$.extend(addressInfoByContry.config,settings);addressInfoByContry.setup();},setup:function(){var previousCountry=addressInfoByContry.config.$items.val();var isDefaultLayout=true;var isCurrentLayoutDefault=true;$(".js-billing-address-form, #billing-address-section").on("change","#guest-country",function(){var isSelectedCountryInList,isCurrentCountryInList,selectedCountry=$(this).val();isSelectedCountryInList=addressInfoByContry.checkCountryInList(selectedCountry);if(isSelectedCountryInList){isDefaultLayout=false;isCurrentLayoutDefault=false;}else{if(!isCurrentLayoutDefault){isDefaultLayout=true;isCurrentLayoutDefault=true;}}
if((isSelectedCountryInList||isDefaultLayout)&&previousCountry!=selectedCountry){addressInfoByContry.call($("#address-section-container"));previousCountry=$(this).val();}else{if(addressInfoByContry.config.$notMvciUrl){addressInfoByContry.callGC(addressInfoByContry.config.$guestInfoContainer,this.value);}}
if(isDefaultLayout){isDefaultLayout=false;}});},url:function(){var ajaxUrl=addressInfoByContry.config.$container.data("url");return ajaxUrl;},gcUrl:function(){var ajaxGCUrl=addressInfoByContry.config.$guestInfoContainer.data("url");ajaxGCUrl=(ajaxGCUrl!=="undefined")?ajaxGCUrl:false
return ajaxGCUrl;},count:0,ajaxCover:{o:$.extend({window:'#ajax-cover',timer:0}),waitingMsg:function(){if($('#ajax-loading,#ajax-reload').css('display')!='inline'){$('#ajax-please-wait').show();}},setCover:function(c){var cover=$(this.o.window),cWidth=c.width(),cHeight=c.height();cover.css({display:'block',zIndex:'100'}).find('.ajax-background').css({opacity:'0.80',width:cWidth,height:cHeight});cover.find('.ajax-inner-container').css({left:cWidth/2-75}).find('#ajax-messaging span').css({display:'none'});addressInfoByContry.ajaxCover.timer=setTimeout("addressInfoByContry.ajaxCover.waitingMsg()",4500);},result:function(code){var cover=$(this.o.window);var ajxMsg=$('#ajax-messaging span');clearTimeout(addressInfoByContry.ajaxCover.timer);if(code==='success'){ajxMsg.css('display','none');$('#ajax-loading').fadeIn(500);cover.find('.ajax-background').animate({opacity:'1.0'},500);return true;}else{ajxMsg.css('display','none');$('#ajax-reload').fadeIn(800);return false;}},close:function(){var cover=$(this.o.window);cover.delay(1000).fadeOut(800);clearTimeout(addressInfoByContry.ajaxCover.timer);return true;}},call:function(c){var temp="";var formValues;var $inLanguage=$("input[name='inLangFormSelected']");if($("#address-section-container").data("enrollment")){temp="signInEnroll=true&"}
if($("#review-guest-billinginformation").length){temp="reviewDetails=true&"}
if(($inLanguage.length>0&&$inLanguage.val()=="true")){temp+="country=CN";}else{temp+="country="+$("#guest-country option:selected").val()}
$.ajax({url:addressInfoByContry.url(),beforeStart:addressInfoByContry.ajaxCover.setCover(c),cache:false,data:temp,dataType:'html',error:function(x,status,error){addressInfoByContry.ajaxCover.close();},timeout:15000,beforeSend:function(){formValues=addressInfoByContry.saveFormValues();},success:function(obj,status,j){addressInfoByContry.ajaxCover.close();var $addressSection=$(obj).find("#address-section-container");var $travelPlannerSection=$(obj).find("#travel-planners-section-container");var $creditCardSection=$(obj).find("#credit-card-section-container");var isWithData=false;$.getScript("/common/js/reservations/billingInformation.js");if($addressSection.length>0&&!($inLanguage.length>0&&$inLanguage.val()=="true")){$("#address-section-container").replaceWith($addressSection);isWithData=true;}
if($travelPlannerSection.length>0){$("#travel-planners-section-container").replaceWith($travelPlannerSection);isWithData=true;}
if($creditCardSection.length>0){$("#credit-card-section-container").replaceWith($creditCardSection);var creditCardInfo={expMonth:$creditCardSection.find('.l-exp-month-tab a'),expYear:$creditCardSection.find('.l-exp-year-tab a'),expMonthDropDown:$creditCardSection.find('.js-exp-month'),expYearDropDown:$creditCardSection.find('.js-exp-year')}
dataBindingCC.init(creditCardInfo);isWithData=true;}
addressInfoByContry.prepopulateFormValues(formValues);if(!isWithData){location.reload();}},error:function(xhr,ajaxOptions,thrownError){location.reload();}}).always(function(){var countryCode=$("#guest-country option:selected").val();if(addressInfoByContry.config.$notMvciUrl){addressInfoByContry.callGC(addressInfoByContry.config.$guestInfoContainer,countryCode);}});},callGC:function(c,countryCode){if(!addressInfoByContry.gcUrl()){return}
$.ajax({url:addressInfoByContry.gcUrl(),cache:false,data:'country='+countryCode,dataType:'html',error:function(x,status,error){addressInfoByContry.updateConsent(c,[false,false,true],"request is failure ...");},timeout:15000,success:function(obj,status,j){obj=$.trim(obj)
if(obj.charAt(0)==="["&&obj.charAt(obj.length-1)==="]"){obj=$.parseJSON(obj);addressInfoByContry.updateConsent(c,obj,"request is success ... ");}else{addressInfoByContry.updateConsent(c,[false,false,true],"sucess but no response... ");}}});},updateConsent:function(container,result,msg){container.find("#field-email-promotional-opt-in").prop("checked",result[0]);container.find("#field-email-third-party-opt-in").prop("checked",result[1]);container.find("#mr-optin-message").toggle(!result[2]);container.find("#terms-privacy-dataProtection-link").toggle(result[2]);},saveFormValues:function(){var $guestInfoForm=$("#guest-payment-form, #modify-guest-info-form");var selectedCreditCard="";if($guestInfoForm.find("#credit-card-type li img.unselected").length>0){selectedCreditCard=$guestInfoForm.find("#credit-card-type li img").not(".unselected").attr("id");}
var formObject={"address":{"addressLine1":$guestInfoForm.find("#address-line1").val(),"addressLine2":$guestInfoForm.find("#address-line2").val(),"city":$guestInfoForm.find("#city").val(),"state":$guestInfoForm.find("#state").val(),"postalCode":$guestInfoForm.find("#postal-code").val(),"nonUSState":$guestInfoForm.find("#non-us-state").val()},"travelPlanners":{"agencyNumber":$guestInfoForm.find("#agency-number").val(),"preferencePlusNumber":$guestInfoForm.find("#preference-plus-number").val()},"creditCard":{"selectedCreditCard":$guestInfoForm.find("input[name='selectedCreditCard']:checked").val(),"alias":$guestInfoForm.find("#credit-card-nickname").val(),"nameOnCreditCard":$guestInfoForm.find("#credit-card-name").val(),"creditCardTypeHidden":$guestInfoForm.find("#credit-card-type-hidden").val(),"creditCardType":selectedCreditCard,"creditCardNumber":$guestInfoForm.find("#credit-card-number").val(),"expMonth":$guestInfoForm.find("#exp-month").val(),"expYear":$guestInfoForm.find("#exp-year").val(),"purpose":$guestInfoForm.find("input[name='purpose']:checked").val()}}
return formObject;},prepopulateFormValues:function(formValues){var $guestInfoForm=$("#guest-payment-form, #modify-guest-info-form");$guestInfoForm.find("#address-line1").val(formValues.address.addressLine1);$guestInfoForm.find("#address-line2").val(formValues.address.addressLine2);$guestInfoForm.find("#city").val(formValues.address.city);$guestInfoForm.find("#state").val(formValues.address.state);$guestInfoForm.find("#postal-code").val(formValues.address.postalCode);$guestInfoForm.find("#non-us-state").val(formValues.address.nonUSState);$guestInfoForm.find("#agency-number").val(formValues.travelPlanners.agencyNumber);$guestInfoForm.find("#preference-plus-number").val(formValues.travelPlanners.preferencePlusNumber);$guestInfoForm.find("#credit-card-nickname").val(formValues.creditCard.alias);$guestInfoForm.find("#credit-card-name").val(formValues.creditCard.nameOnCreditCard);$guestInfoForm.find("#credit-card-number").val(formValues.creditCard.creditCardNumber);$guestInfoForm.find("#credit-card-type-hidden").val(formValues.creditCard.creditCardTypeHidden);$guestInfoForm.find("#exp-month").val(formValues.creditCard.expMonth);$guestInfoForm.find("#exp-year").val(formValues.creditCard.expYear);$guestInfoForm.find('li.is-active').removeClass('is-active');$guestInfoForm.find('.l-exp-month-tab [data-date = '+formValues.creditCard.expMonth+']').parent('li').addClass('is-active');$guestInfoForm.find('.l-exp-year-tab [data-date = '+formValues.creditCard.expYear+']').parent('li').addClass('is-active');if(formValues.creditCard.creditCardType.length>0){var $selectedCreditCard=$('#credit-card-type li img#'+formValues.creditCard.creditCardType);var altText="";$("#credit-card-type li img").each(function(){altText=$(this).data('options').accept;$(this).removeClass('unselected').addClass('unselected').attr('title',altText).attr('alt',altText);});altText=$selectedCreditCard.data('options').selected;$selectedCreditCard.removeClass("unselected").attr('title',altText).attr('alt',altText);}else{$("#credit-card-type li img").each(function(){var altText=$(this).data('options').accept;$(this).removeClass('unselected').attr('title',altText).attr('alt',altText);});}
var selectedCreditCard="input[name='selectedCreditCard'][value='"+formValues.creditCard.selectedCreditCard+"']";$guestInfoForm.find("input[name='selectedCreditCard']").removeAttr("checked");$guestInfoForm.find(selectedCreditCard).prop("checked",true);var purpose="input[name='purpose'][value='"+formValues.creditCard.purpose+"']";$guestInfoForm.find("input[name='purpose']").removeAttr("checked");$guestInfoForm.find(purpose).prop("checked",true);},checkCountryInList:function(country){var isCountryInList=false;var addressCountryList=[];var travelPlannerCountryList=[];var creditCardCountryList=[];var $inLanguage=$("input[name='inLangFormSelected']");var $addressSection=$("#address-section-container");var $travelPlannerSection=$("#travel-planners-section-container");var $creditCardContainer=$("#credit-card-section-container");if($addressSection.length&&!($inLanguage.length>0&&$inLanguage.val()=="true")){addressCountryList=$addressSection.data("country").split(",");if($.inArray(country,addressCountryList)!=-1){isCountryInList=true;}}
if($travelPlannerSection.length){travelPlannerCountryList=$travelPlannerSection.data("country").split(",");if($.inArray(country,travelPlannerCountryList)!=-1){isCountryInList=true;}}
if($creditCardContainer.length){creditCardCountryList=$creditCardContainer.data("country").split(",");if($.inArray(country,creditCardCountryList)!=-1){isCountryInList=true;}}
return isCountryInList;},rewardAddress:function(isEnrollment){var isSelectedCountryInList=false;var selectedCountry=$("#guest-country option:selected").val();var $countryAjaxContainer=$("#address-section-container");var $inLanguage=$("input[name='inLangFormSelected']");$countryAjaxContainer.data("enrollment",isEnrollment);if($inLanguage.val()=="true"){var $provinceLabel=$(".js-cn-state-label");var $cityLabel=$(".js-cn-city-label");var $addressLabel=$(".js-cn-address-label");var $addressFields=$(".js-cn-address");var requiredIcon="<i class='icon icon-asterisk t-form-asterisk'></i>";$addressFields.find(".icon").remove();if(isEnrollment=="true"){$provinceLabel.addClass("is-required").append(requiredIcon);$cityLabel.addClass("is-required").append(requiredIcon);$addressLabel.addClass("is-required").append(requiredIcon);}
else{$cityLabel.addClass("is-required").append(requiredIcon);}
selectedCountry="CN";}
if(selectedCountry!==undefined&&selectedCountry.length>0){selectedCountry+="MR";isSelectedCountryInList=addressInfoByContry.checkCountryInList(selectedCountry);if(isSelectedCountryInList){addressInfoByContry.call($countryAjaxContainer);}}}};var guestInfoInlineJoinNow={config:{$items:$("#guest-join-now"),$container:$(".js-guestinfo-join-panel")},init:function(settings){$.extend(guestInfoInlineJoinNow.config,settings);if(guestInfoInlineJoinNow.config.$items.is(":checked")){guestInfoInlineJoinNow.config.$container.show();}
else{guestInfoInlineJoinNow.config.$container.hide();guestInfoInlineJoinNow.config.$container.find(":text, :password").val("");}
guestInfoInlineJoinNow.setup();},setup:function(){guestInfoInlineJoinNow.config.$items.on("change",function(){if($(this).is(":checked")){guestInfoInlineJoinNow.config.$container.show();addressInfoByContry.rewardAddress("true");}
else{guestInfoInlineJoinNow.config.$container.hide();guestInfoInlineJoinNow.config.$container.find(":text, :password").val("");addressInfoByContry.rewardAddress("");}});}};var guestInfoCardHolderName={init:function(settings){guestInfoCardHolderName.setup();},setup:function(){$("#guest-payment-form, #modify-guest-info-form").on("change","#first-name",function(){guestInfoCardHolderName.populateCardHolderName();});$("#guest-payment-form, #modify-guest-info-form").on("change","#last-name",function(){guestInfoCardHolderName.populateCardHolderName();});},populateCardHolderName:function(){var firstName=$("#first-name").val();var lastName=$("#last-name").val();if(firstName.length!=0&&lastName.length!=0)
{var cardHolderNameLang=$("html").attr("lang");if(cardHolderNameLang=="zh-CN"||cardHolderNameLang=="ja-JP")
{$("#credit-card-name").val(lastName+" "+firstName);}
else
{$("#credit-card-name").val(firstName+" "+lastName);}}}};$(function()
{var adaraIframes=$("div.bt-ad-placement-iframe");adaraIframes.filter("[id*=marriott-US-view-rez-right-rail]").adaraUpcomingRes();adaraIframes.filter("[id*=marriott-US-modify-rez-right-rail-]").adaraModifyRes();adaraIframes.filter("[id*=marriott-US-mod-room-preferences-right-rail-]").adaraModRezRoomPrefs();adaraIframes.filter("[id*=marriott-US-mod-guest-info-right-rail-]").adaraModRezGuestInfo();adaraIframes.filter("[id*=marriott-US-mod-room-type-right-rail-]").adaraModRezRoomType();adaraIframes.filter("[id*=marriott-US-remove-room-right-rail-]").adaraModRezRemoveRoom();$("form#dates-rates-form").find(".senior-discount").css({'text-decoration':'underline','color':'#3333CC'});$(".senior-discount").click(function(){sendto('US','Marriott','/specials/senior/default.mi','3');return false;});$("form#guestInformationModifyForm").submit(function(){if($("input[name='partnerSite']").val())
{var submit=true;}
else
{var submit=validateRewardsNumber();}
return submit;});$('#remove-room').submit(function(){return removeRoomCheck();});if($('#lookup-form-wrapper').length>0){var biggestHeight=0;$('.call-out').each(function(){if($(this).height()>biggestHeight){biggestHeight=$(this).height();}});$('.call-out').height(biggestHeight);$("#username").attr("autocomplete","off");}
$('#redemption-rate-charge-message').hide();$('#purchase-points-message').hide();if($('#purchase-points').length>0&&$('#purchase-points').is(':checked')){$('#redemption-rate-charge-message').show();$('#purchase-points-message').show();$('#finalize-redemption-message').hide();}
$('#attach-cert, #purchase-points, #do-nothing, #purchase-points-check').click(function(){if($(this).val()=='PurchasePoints'){$('#redemption-rate-charge-message').show();$('#purchase-points-message').show();$('#finalize-redemption-message').hide();}
else{$('#redemption-rate-charge-message').hide();$('#purchase-points-message').hide();$('#finalize-redemption-message').show();}});$("#modify-billing-container #cancel-change-button").bind("click keypress",function(){confirmCancelReservationEvent($(this));return false;});});$('#confirm-cancel').on('click',function(e){e.preventDefault();var $this=$(this);var displayContext='';var lastName=$this.data('lastname');var confirmationNumber=$this.data('confirmationnumber');if(!lastName||lastName.length===0){throw"Last name is empty.";}
if(!$.isNumeric(confirmationNumber)){throw"Confirmation number must be a number. Got '"+confirmationNumber+"'";}
if($this.data('site').length>0){displayContext=$this.data('site');}
var URL=displayContext+'/reservation/confirmCancelReservationDialog.mi?lastName='+lastName+'&confirmationNumber='+confirmationNumber;if(windowURL.match('ritz')||windowURL.match('mvci')||windowURL.match('bulgari')){var windowprops="height=320,width=600,location=no,left=300,top=300,scrollbars=no,menubars=no,toolbars=no,resizable=yes";window.open(URL,"ConfirmCancellation",windowprops);}else{confirmationModal(URL);}});function confirmationModal(URL){var closeText=msgResources.closeText||'Close';var loadingText=msgResources.loadingText||'Loading...';var mainClassStyles='m-modal t-modal-lang';$.magnificPopup.open({mainClass:mainClassStyles,items:{src:URL},type:'ajax',ajax:{settings:{dataType:'html'}},closeMarkup:'<div class="m-modal-utilities"><button class="m-modal-close mfp-close">%title% <i class="icon-close"></i></button></div>',tClose:closeText,tLoading:loadingText,callbacks:{beforeOpen:function(){this.container.attr('aria-live','assertive');},parseAjax:function(mfpResponse){var frag=$(mfpResponse.data).find('#layout-body-container');frag.addClass('l-container');mfpResponse.data=frag;},ajaxContentAdded:function(){$('.mfp-close .icon-close, #no-confirm').on('click',function(e){e.preventDefault();$.magnificPopup.close();});}}});}
function removeRoomCheck(){var total=0;var numberOfRooms=$("input[name='num_of_rooms']").val();var removeRoom1=$("#remove-room :input[name='removeRoom1']").attr("checked");if(numberOfRooms>1){var removeRoom2=$("#remove-room :input[name='removeRoom2']").attr("checked");}
if(numberOfRooms>2){var removeRoom3=$("#remove-room :input[name='removeRoom3']").attr("checked");}
if(removeRoom1){total+=1;}
if(removeRoom2){total+=1;}
if(removeRoom3){total+=1;}
if(total==numberOfRooms){$('#errorMessageDisplay').show();$('#errorMessageDisplayNew').hide();removeRoomUncheck();return false;}
if(total==0){$('#errorMessageDisplayNew').show();$('#errorMessageDisplay').hide();return false;}
return true;}
function removeRoomUncheck(){var formArray=$("#remove-room :input[name^='removeRoom'][type='checkbox']");for(var j=0;j<formArray.length;j++)
{var element=formArray[j];element.checked=false;}}
var displayContext='';$('#confirm-details').ready(function(){$('#cancel-link').click(function(){confirmCancelReservationEvent($(this));return false;});$('#purchase-points-check').change(function(){$("#purchase-points-toggle").slideToggle();if(!$('#purchase-points-check').is(':checked')){$('#redemption-rate-charge-message').hide();$('#purchase-points-message').hide();$('#finalize-redemption-message').show();}});$('.js-link-for-venezuela').click(function(){if($("#checkForAgreement").is(':checked')){$('#confirm-details').submit();}
else{$('.l-agreement-section').addClass("l-adv-checkbox-error");$('.agreement-required-label').show();}});});function confirmCancelReservationEvent(button){displayContext="";if($(button).data('site').length&&$(button).data('site').length>0){displayContext=$(button).data('site');}
var path=displayContext+'/reservation/confirmCancelReservationChanges.mi';var upsellFlag=$("#upsellFlag").val();if(upsellFlag=='true'){path=path+"?upsell=true";}
var windowprops="height=200,width=360,location=no,left=300,top=300,scrollbars=no,menubars=no,toolbars=no,resizable=yes";window.open(path,"CancelReservationChanges",windowprops);}
function validateRewardsNumber(formName){var rewardsAccountId=$(formName+' :hidden[name=accountId]').val();var requestedRewardsId=$(formName+' #rewards-number').val();var choice=true;if($(formName+' :hidden[name=accountId]').length>0){if(rewardsAccountId!=requestedRewardsId){var message=$(formName+" input[name='rewardsNoMatch']").val()+rewardsAccountId+$(formName+" input[name='pointsToReserve']").val();choice=confirm(message);if(choice==true){$(formName+' #rewards-number').val(rewardsAccountId);}}}else{return true;}
return choice;}
$('form#guestInformationModifyForm').ready(function(){$("form#guestInformationModifyForm #cancel-change-link").click(function(){confirmCancelReservationEvent($(this));return false;});});if($("#forward-uri").length>0){parent.location.href=$("input[name='forwardPageUrl']").val();}
function equalHeight(group){var tallest=0;group.each(function(){var thisHeight=$(this).height();if(thisHeight>tallest){tallest=thisHeight;}});group.height(tallest);}
$(function(){if($('body').hasClass('lt-ie9')&&$('.reservation-info-section').length>0){equalHeight($('.reservation-info-section'));}});var smsPopover=function(obj){var respopover={},thisUrl=obj.attr('href'),closeText=msgResources.closeText||'Close',loadingText=msgResources.loadingText||'Loading...';if(obj.length){$.magnificPopup.open({mainClass:'m-modal t-modal-med',items:{src:thisUrl,type:'ajax'},ajax:{settings:{dataType:'html'}},closeMarkup:'<div class="m-modal-utilities">'+'<button class="m-modal-close mfp-close is-hover-fix" type="button">%title% <i class="icon mfp-close icon-close"></i></button>'
+'</div>',tClose:closeText,tLoading:loadingText,callbacks:{beforeOpen:function(){this.container.attr('aria-live','assertive');$('#page-container').attr('aria-hidden','true');},parseAjax:function(mfpResponse){var frag=$(mfpResponse.data).find('.l-body-container');mfpResponse.data=frag;},ajaxContentAdded:function(){var self=this;var formConatiner=self.container.find('#sms-contry-code');var smsTermCondition=self.container.find('.js-sms-term');var enTermCondition=self.container.find('.js-en-term');var isVisibleCA=self.container.find('.is-visible-ca');var isHiddenCA=self.container.find('.is-hidden-ca');var gbMessaging=self.container.find('.js-gb-msg');var cnTermCondition=self.container.find('.js-cn-term');var actionSelector=self.container.find('form[id=smsForm]');var $mfpContainer=self.container.find('.mfp-content');var countryCode=self.container.find('#sms-contry-code').val();function setSmsVisible(){enTermCondition.removeClass('is-hidden');smsTermCondition.removeClass('is-hidden');if(countryCode=="country.code.FR"||countryCode=="country.code.UK"){gbMessaging.removeClass('is-hidden');smsTermCondition.addClass('is-transition-hidden');}else if(countryCode=="country.code.CN"||countryCode=="country.code.HK"){smsTermCondition.removeClass('is-transition-hidden');cnTermCondition.removeClass('is-hidden');enTermCondition.addClass('is-transition-hidden');gbMessaging.addClass('is-hidden');}else{if(countryCode=="country.code.CA"){isVisibleCA.removeClass('is-hidden');isHiddenCA.addClass('is-hidden');}else if(countryCode=="country.code.US"){isVisibleCA.addClass('is-hidden');isHiddenCA.removeClass('is-hidden');}
smsTermCondition.removeClass('is-transition-hidden');enTermCondition.removeClass('is-transition-hidden');gbMessaging.addClass('is-hidden');cnTermCondition.addClass('is-hidden');}}
setSmsVisible();formConatiner.on('change.smsform',function(){countryCode=$(this).val();setSmsVisible();});actionSelector.on('submit.smsform',function(e){e.preventDefault();var $form=$(this);var $formValues=$form.serialize();var url=$form.prop('action');$.post(url,$formValues,function(data){var content=$(data).find('#sms-panel');var errorMsg=content.find('#error-messages');if(errorMsg.length){$('#error-messages').remove();gbMessaging.before(errorMsg);}else{$mfpContainer.find('#sms-panel > :not(.m-modal-utilities)').remove();$("#sms-panel",$mfpContainer).append(content);}});});},close:function(){$('#page-container').removeAttr('aria-hidden');}}});}};$(function(){$('.js-order-cert-panel').removeClass('hidden');if($('#edit-dates-confirmation').length>0)
{var cancelText='';if(document.getElementById('cancelText')){var cancelText=$('#cancelText').val();}
var cancelLink=' <a href="" class="button-submit cancel" id="cancel" title="'+cancelText+'"><em>'+cancelText+'</em></a>';$('#edit-dates-confirmation a#continue').after(cancelLink);$('a#cancel').bind('click',function(){window.close();return false;});$('#edit-dates-confirmation #continue').click(function(){var url=$(this).attr('href');window.opener.location=url;window.close();return false;});}
if($('.print-reservation-container').length>0)
{$('.reservation-info-section-container').each(function(){$(this).children('.reservation-info-section').height($(this).height());});}
if($('.reservation-body-container').length>0)
{$('#cancelBtn').click(function(){$('#preferences-fade-section,#preferences-fade-section-hidden').toggle();$('#change-preferences-section,#change-preferences-section-active').slideToggle();return false;});}
if(($.browser.msie&&$.browser.version=='7.0'&&document.documentMode&&document.documentMode=='7')||($.browser.msie&&$.browser.version=='8.0'&&document.documentMode&&document.documentMode=='7')||($.browser.msie&&$.browser.version=='9.0'&&document.documentMode&&document.documentMode=='7')){$('.res-offer-container').css('clear','both');}
if($('#edit-preferences').length>0){$('#edit-preferences').click(function(){$('#preferences-fade-section,#preferences-fade-section-hidden').fadeOut();$('#change-preferences-section,#change-preferences-section-active').slideToggle();return false;});}
if($('#reservation-summary-container').length>0&&$('.print-reservation-container').length==0){var purchasePointsCheckBox=$('.selection-container #purchase-points-check')
if($(purchasePointsCheckBox).length>0&&!$(purchasePointsCheckBox).is(':checked'))
{$('#submit-changes-button').hide();}
$(purchasePointsCheckBox).click(function(){$('#submit-changes-button').toggle();});}
if($('#confirm-details').length>0){$('form[id="confirm-details"]').submit(function(){$(this).find('button').css('backgroundColor','#999').attr('disabled','disabled');});}
$('.offers-container .article-container .column .article-content.layout-6 img').each(function(){var floatedElement=($(this).parent().is('a'))?$(this).parent():$(this);if(floatedElement.closest('div').hasClass('article-content')){floatedElement.siblings().wrapAll('<div class="left-column"></div>');floatedElement.wrap('<div class="right-column"></div>');}});var $redemptionToggleContainer=$('.js-rdmptn-toggle-container');var $paymentOptionsControl=$('input[name="redemptionSelection"]');var _togglePaymentPanel=function(obj){var id=obj.attr("id");var content=".js-"+id+"-panel";if(obj.prop("checked")==true){$redemptionToggleContainer.addClass('is-hidden');$(content).removeClass('is-hidden');if((obj.attr('type')=='checkbox')&&(id=='purchase-points')){$('.js-purchase-points-checked').show();$('.js-purchase-points-unchecked').hide();}}
else{$(content).addClass('is-hidden');if((obj.attr('type')=='checkbox')&&(id=='purchase-points')){$('.js-purchase-points-checked').hide();$('.js-purchase-points-unchecked').show();}}}
$paymentOptionsControl.each(function(index,row){_togglePaymentPanel($(this));})
$paymentOptionsControl.on('click',function(){_togglePaymentPanel($(this));});$('.js-purchase-points-unchecked a').on('click',function(){$('.js-purchase-points-unchecked').hide();$('.js-purchase-points-checked').show();$('#purchase-points').prop('checked',true);});if($('#facebook-dialog').length>0){$('#facebook-dialog').show();$("#fb-share-link").click(function(){var winTop=window.outerHeight/2-125;var winLeft=window.outerWidth/2-275;window.open($(this).attr('href'),'_blank','top='+winTop+',left='+winLeft+',width=550,height=250,location=no,menubar=no,scrollbars=no,status=no,toolbar=no');return false;});}
var $redemptionToggleContainer=$('.js-rdmptn-toggle-container');var $paymentOptionsControl=$('input[name="redemptionSelection"]');var _togglePaymentPanel=function(obj){var id=obj.attr("id");var content=".js-"+id+"-panel";if(obj.prop("checked")==true){$redemptionToggleContainer.addClass('is-hidden');$(content).removeClass('is-hidden');if((obj.attr('type')=='checkbox')&&(id=='purchase-points')){$('.js-purchase-points-checked').show();$('.js-purchase-points-unchecked').hide();}}
else{$(content).addClass('is-hidden');if((obj.attr('type')=='checkbox')&&(id=='purchase-points')){$('.js-purchase-points-checked').hide();$('.js-purchase-points-unchecked').show();}}}
var $smsContryCode=$('#sms-contry-code');var _toggleSmsTerms=function(obj){var countryCode=obj.val()
if(countryCode=="country.code.US"){$("#sms-term-container").addClass('hidden')}}
$paymentOptionsControl.each(function(index,row){_togglePaymentPanel($(this));})
$paymentOptionsControl.on('click',function(){_togglePaymentPanel($(this));});$('.js-res-popover').on('click',function(e){e.preventDefault();smsPopover($(this));});});var ancillaryProducts={renderDisplay:function(){var carsList;var activitiesList;var ancillaryCity;var iseatzContainer=$('#iseatz-container');iseatzContainer.css('display','block');if(iseatzContainer.length>0){var oCarImage=$('#ancillary-product-carImage'),oCarContent=$('#ancillary-product-carContent');AncillaryProductsRemoteService.retrieveAncillaryProducts(window.location.pathname,{callback:function(data){var showAncillaryProducts=false;var numActivities=3;carsList=data['carsList'];activitiesList=data['activitiesList'];if(carsList!=undefined&&carsList!=null&&carsList.length>0){var lastProductClass="";if(!(activitiesList!=undefined&&activitiesList!=null&&activitiesList.length>0)){lastProductClass="last-product";}
showAncillaryProducts=true;numActivities=2;oCarImage.append('<div class="product-image-wrapper first-product '+lastProductClass+'"><a href="'+carsList[0].productURL+'" target="_new" title="'+$("#iseatz-container input[name=visitTripMarriottComText]").val()+'"><img alt="'+$("#iseatz-container input[name=hertzCarDescText]").val()+'" src="'+carsList[0].imageURL+'"/></a></div>');oCarContent.append('<div class="product-text-wrapper first-product '+lastProductClass+'"><p class="featured-products">'+$("#iseatz-container input[name=featuredProductsText]").val()+'</p><a href="'+carsList[0].productURL+'" target="_new" title="'+$("#iseatz-container input[name=visitTripMarriottComText]").val()+'">'+$("#iseatz-container input[name=carDesc]").val()+'</a><img alt="'+$("#iseatz-container input[name=carDesc]").val()+'" class="win-icon" src="/Images/Arrows/red_right.gif"/><p><span>'+$("#iseatz-container input[name=fromText]").val()+' </span><span class="product-rate">'+carsList[0].averageDailyAmount+'</span> '+carsList[0].currencyCode+'</p></div>');}
if(activitiesList!=undefined&&activitiesList!=null&&activitiesList.length>0){if(numActivities>activitiesList.length){numActivities=activitiesList.length;}
for(var i=0;i<numActivities;i++){var className="";var lastProductClass="";var rateInfo="";if(i==(numActivities-1)){lastProductClass="last-product";}
if(!showAncillaryProducts){className="first-product";}
showAncillaryProducts=true;if(activitiesList[i].rateAmount!=undefined||activitiesList[i].rateAmount!=null){rateInfo='<span>'+$("#iseatz-container input[name=fromText]").val()+' </span><span class="product-rate">'+activitiesList[i].rateAmount+'</span> '+activitiesList[i].currencyCode;}
if(className!=""){oCarImage.append('<div class="product-image-wrapper '+className+' '+lastProductClass+'"><a href="'+activitiesList[i].productURL+'" target="_new" title="'+$("#iseatz-container input[name=visitTripMarriottComText]").val()+'"><img alt="'+$("#iseatz-container input[name=hertzCarDescText]").val()+'" src="'+activitiesList[i].imageURL+'"/></a></div>');}
oCarContent.append('<div class="product-text-wrapper '+className+' '+lastProductClass+'"><p class="featured-products">'+$("#iseatz-container input[name=featuredProductsText]").val()+'</p><a href="'+activitiesList[i].productURL+'" target="_new" title="'+$("#iseatz-container input[name=visitTripMarriottComText]").val()+'">'+activitiesList[i].shortName+'</a><img alt="'+$("#iseatz-container input[name=featuredProductsText]").val()+'" class="win-icon" src="/Images/Arrows/red_right.gif"/><p>'+rateInfo+'</p></div>');}}
$('#ancillary-products-overlay').remove();$('#enhance-your-trip').css('display','block');$('#ancillary-product-display').css('display','block');if(showAncillaryProducts==false){iseatzContainer.remove();}},errorHandler:function(message){iseatzContainer.remove();}});}
var ancillaryDynamicMessagingPlaceholder=$('#ancillary-dynamic-messaging-placeholder');if(ancillaryDynamicMessagingPlaceholder.length>0){ancillaryDynamicMessagingPlaceholder.remove();var ancillaryContainer=$('#ancillary-container');var ancillaryDynamicMessaging=$('#ancillary-dynamic-messaging');ancillaryDynamicMessaging.hide();ancillaryContainer.append('<div id="ancillary-products-overlay"></div>');AncillaryProductsRemoteService.retrieveAncillaryProducts(window.location.pathname,{callback:function(data){var showAncillaryProducts=false;carsList=data['carsList'];activitiesList=data['activitiesList'];ancillaryCity=data['ancillaryCity'];if(carsList!=undefined&&carsList!=null&&carsList.length>0){showAncillaryProducts=true;var carDescription=carsList[0].description;if(carDescription==("Description Not Available")){carDescription=carsList[0].name;}
ancillaryDynamicMessaging.append('<p><span>'+$("#ancillary-dynamic-messaging input[name=carText]").val()+'</span><br/><a href="'+carsList[0].productURL+'" target="_new" title="'+$("#ancillary-container input[name=tripDotMarriottDotComCopy]").val()+'">'+carDescription+' '+$("#ancillary-dynamic-messaging input[name=fromText]").val()+' '+carsList[0].averageDailyAmount+' '+carsList[0].currencyCode+'<img alt="'+$("#ancillary-container input[name=tripDotMarriottDotComCopy]").val()+'" class="win-icon" src="/Images/Icons/external_icon.gif"/></a></p>');}
if(activitiesList!=undefined&&activitiesList!=null&&activitiesList.length>0){showAncillaryProducts=true;var rateInfo="";if(activitiesList[0].rateAmount!=undefined||activitiesList[0].rateAmount!=null){rateInfo=' '+$("#ancillary-dynamic-messaging input[name=fromText]").val()+' '+activitiesList[0].rateAmount+' '+activitiesList[0].currencyCode;}
ancillaryDynamicMessaging.append('<p><span>'+$("#ancillary-dynamic-messaging input[name=ticketAttractionText]").val()+'</span><br/><a href="'+activitiesList[0].productURL+'" target="_new" title="'+$("#ancillary-container input[name=tripDotMarriottDotComCopy]").val()+'">'+activitiesList[0].shortName+rateInfo+'<img alt="'+$("#ancillary-container input[name=tripDotMarriottDotComCopy]").val()+'" class="win-icon" src="/Images/Icons/external_icon.gif"/></a></p>');}
$('#ancillary-products-overlay').remove();if(showAncillaryProducts){ancillaryDynamicMessaging.prepend('<h2>'+ancillaryCity[0]+' </h2>');ancillaryDynamicMessaging.show();}},errorHandler:function(message){ancillaryContainer.remove();}});}}}
$(function(){ancillaryProducts.renderDisplay();});